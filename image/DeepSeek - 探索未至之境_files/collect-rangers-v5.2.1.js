(()=>{var u=function(){return(u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,a,s,c){return new(s=s||Promise)(function(n,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function i(e){try{r(c.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,i)}r((c=c.apply(e,a||[])).next())})}function p(o,i){var r,a,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,a=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))c.label=t[1];else if(6===t[0]&&c.label<s[1])c.label=s[1],s=t;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(t)}}t=i.call(o,c)}catch(e){t=[6,e],a=0}finally{r=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function f(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(o=r.next()).done;)a.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a}function h(e,t){for(var n=0,o=t.length,i=e.length;n<o;n++,i++)e[i]=t[n];return e}function N(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function U(e){return"boolean"==typeof e}function L(e){return void 0===e}function P(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEven?e.attachEven("on".concat(t),n):e["on".concat(t)]=n}function z(e,t,n,o){e.addEventListener?e.removeEventListener(t,n,o):e.attachEven&&e.detachEven("on".concat(t),n)}function j(e){if("string"==typeof e){for(var t=[],n=String.fromCharCode(122),o=e.split(n),i=0;i<o.length;i++){var r=64^+parseInt(o[i],25),r=String.fromCharCode(r);t.push(r)}return t.join("")}}function V(e){var t=-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("Mac OS X");P(window,t?"pagehide":"beforeunload",e,!1)}function K(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t}function q(e){var t=document.createElement("a");return t.href=e,t}function H(e){var i={};try{q(e).search.slice(1).split("&").forEach(function(e){var t,n,o=e.split("=");o.length&&(t=o[0],n=o[1]);try{i[t]=decodeURIComponent(void 0===n?"":n)}catch(e){i[t]=n}})}catch(e){}return i}function J(e){for(var t=0,n=0,o=(e+="").length,i=0;i<o;i++)(0x7fffffffffff<(t=31*t+e.charCodeAt(n++))||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}function F(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&(-1!==t.indexOf("MSIE 8.0")||-1!==t.indexOf("MSIE 7.0")||-1!==t.indexOf("MSIE 9.0"))}e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(n,o){var i=this;n&&o&&"function"==typeof o&&this.on(n,function e(t){o(t),i.off(n,e)})},e.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&(t?-1!==(t=this._hooks[e].indexOf(t))&&this._hooks[e].splice(t,1):this._hooks[e]=[])},e.prototype.emit=function(e,t,n){n?e&&(-1!==this._cache.indexOf(n)?this._emit(e,t):(this._hooksCache.hasOwnProperty(n)||(this._hooksCache[n]={}),this._hooksCache[n].hasOwnProperty(e)||(this._hooksCache[n][e]=[]),this._hooksCache[n][e].push(t))):this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&h([],f(this._hooks[e])).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)};var W,X=e,$=function(e){return Array.isArray(e)},Q=(W=+Date.now()+Number("".concat(Math.random()).slice(2,8)),function(e,t,n){var o=document.createElement("script");o.src=e,o.onerror=function(){n(e)},o.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(o)}),Y=function(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&(-1!==t.indexOf("MSIE 8.0")||-1!==t.indexOf("MSIE 9.0"))},Z=function(){var e=window.navigator.appName,t=window.navigator.userAgent;return-1!==e.indexOf("Microsoft Internet Explorer")&&-1!==t.indexOf("MSIE 7.0")},ee="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e){this._hooks={},this._cache=[],this._hooksCache={}}function te(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function ne(e,t){return e(t={exports:{}},t.exports),t.exports}var d=ne(function(e,t){e.exports=function(){function s(){for(var e=0,t={};e<arguments.length;e++){var n,o=arguments[e];for(n in o)t[n]=o[n]}return t}function l(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(c){function a(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s({path:"/"},a.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(t);/^[\{\[]/.test(o)&&(t=o)}catch(e){}t=c.write?c.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i,r="";for(i in n)n[i]&&(r+="; "+i,!0!==n[i])&&(r+="="+n[i].split(";")[0]);return document.cookie=e+"="+t+r}}function t(e,t){if("undefined"!=typeof document){for(var n={},o=document.cookie?document.cookie.split("; "):[],i=0;i<o.length;i++){var r=o[i].split("="),a=r.slice(1).join("=");t||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var s=l(r[0]),a=(c.read||c)(a,s)||l(a);if(t)try{a=JSON.parse(a)}catch(e){}if(n[s]=a,e===s)break}catch(e){}}return e?n[e]:n}}return a.set=n,a.get=function(e){return t(e,!1)},a.getJSON=function(e){return t(e,!0)},a.remove=function(e,t){n(e,"",s(t,{expires:-1}))},a.defaults={},a.withConverter=e,a}(function(){})}()}),oe=(ie.prototype.setItem=function(e,t){this.cache[e]=t},ie.prototype.getItem=function(e){return this.cache[e]},ie.prototype.removeItem=function(e){this.cache[e]=void 0},ie.prototype.getCookie=function(e){this.getItem(e)},ie.prototype.setCookie=function(e,t){this.setItem(e,t)},ie.prototype.removeCookie=function(e,t){this.removeItem(e)},ie);function ie(){this.cache={}}var re={getItem:function(e){try{var t=localStorage.getItem(e),n=t;try{t&&"string"==typeof t&&(n=JSON.parse(t))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(e,t){try{var n="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,n)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){try{return d.get(e)}catch(e){return""}},setCookie:function(e,t,n,o){try{var i=o||document.domain,r=+new Date+n;d.set(e,t,{expires:new Date(r),path:"/",domain:i})}catch(e){}},removeCookie:function(e,t){try{d.remove(e,{path:"/",domain:t||""})}catch(e){}},isSupportLS:(()=>{try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}})()},ae={getItem:function(e){try{var t=sessionStorage.getItem(e),n=t;try{t&&"string"==typeof t&&(n=JSON.parse(t))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(e,t){try{var n="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,n)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:function(e,t){this.setItem(e,t)},removeCookie:function(e,t){this.removeItem(e)},isSupportSession:(()=>{try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}})()},g=(ue.prototype.getItem=function(e){return this._storage.getItem(e)},ue.prototype.setItem=function(e,t){this._storage.setItem(e,t)},ue.prototype.removeItem=function(e){this._storage.removeItem(e)},ue.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},ue.prototype.setCookie=function(e,t,n,o){this._storage.setCookie(e,t,n,o)},ue.prototype.removeCookie=function(e,t){this._storage.removeCookie(e,t)},ue),se=(le.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,n=document.referrer,o=n?q(n).hostname:"",i=H(window.location.href),r="web",i=(-1===this.appVersion.indexOf("Mobile")&&-1===this.appVersion.indexOf("Android")&&-1===this.appVersion.indexOf("iPhone")&&-1===this.appVersion.indexOf("iPad")&&-1===this.appVersion.indexOf("mini")||(r="wap"),this.utm=((e,t,n,o)=>{var i=new g(!1),r=new g(!1,"session"),a=e?"_tea_utm_cache_".concat(e):"_tea_utm_cache",s=e?"_$utm_from_url_".concat(e):"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],u={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var h,p,f=!1;for(h in u)u[h]&&(-1!==l.indexOf(h)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[h]=u[h]):c[h]=u[h],f=!0);f?(r.setItem(s,"1"),i.setCookie(a,JSON.stringify(c),o,n)):(p=i.getCookie(a,n))&&(c=JSON.parse(p)),1==r.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return u}return c})(this.appid,i,this.domain,this.cookie_expire),this.browser()),a=this.os();return{browser:i.browser,browser_version:i.browser_version,platform:r,os_name:a.os_name,os_version:a.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(a.os_name),language:t,referrer:n,referrer_host:o,utm:this.utm,latest_data:this.last(n,o)}},le.prototype.last=function(e,t){var n="",o="",i="",r=location.hostname,a=!1;return e&&t&&r!==t&&(o=t,a=!0,(r=H(n=e)).keyword)&&(i=r.keyword),{$latest_referrer:n,$latest_referrer_host:o,$latest_search_keyword:i,isLast:a}},le.prototype.browser=function(){var e,t="",n="".concat(parseFloat(this.appVersion)),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(t="Microsoft Edge",n=-1!==o.indexOf("Edge")?(e=o.indexOf("Edge"),o.substring(e+5)):(e=o.indexOf("Edg"),o.substring(e+4))):-1!==o.indexOf("MSIE")||-1!==o.indexOf("Trident")?(t="Microsoft Internet Explorer",n=-1!==o.indexOf("MSIE")?(e=o.indexOf("MSIE"),o.substring(e+5,e+9)):(e=o.indexOf("rv"),o.substring(e+3,e+7))):-1!==(e=o.indexOf("Lark"))?(t="Lark",n=o.substring(e+5,e+11)):-1!==(e=o.indexOf("MetaSr"))?(t="sougoubrowser",n=o.substring(e+7,e+10)):-1!==o.indexOf("MQQBrowser")||-1!==o.indexOf("QQBrowser")?(t="qqbrowser",-1!==o.indexOf("MQQBrowser")?(e=o.indexOf("MQQBrowser"),n=o.substring(e+11,e+15)):-1!==o.indexOf("QQBrowser")&&(e=o.indexOf("QQBrowser"),n=o.substring(e+10,e+17))):-1!==o.indexOf("Chrome")?-1!==(e=o.indexOf("MicroMessenger"))?(t="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("360"))?(t="360browser",n=o.substring(o.indexOf("Chrome")+7)):-1!==o.indexOf("baidubrowser")||-1!==o.indexOf("BIDUBrowser")?(-1!==o.indexOf("baidubrowser")?(e=o.indexOf("baidubrowser"),n=o.substring(e+13,e+16)):-1!==o.indexOf("BIDUBrowser")&&(e=o.indexOf("BIDUBrowser"),n=o.substring(e+12,e+15)),t="baidubrowser"):-1!==(e=o.indexOf("xiaomi"))?n=-1!==o.indexOf("openlanguagexiaomi")?(t="openlanguage xiaomi",o.substring(e+7,e+13)):(t="xiaomi",o.substring(e-7,e-1)):-1!==(e=o.indexOf("TTWebView"))?(t="TTWebView",n=o.substring(e+10,e+23)):-1===(e=o.indexOf("Chrome"))&&-1===(e=o.indexOf("Chrome"))||(t="Chrome",n=o.substring(e+7)):-1!==o.indexOf("Safari")?-1!==(e=o.indexOf("QQ"))?(t="qqbrowser",n=o.substring(e+10,e+16)):-1!==(e=o.indexOf("Safari"))&&(t="Safari",n=o.substring(e+7),-1!==(e=o.indexOf("Version")))&&(n=o.substring(e+8)):-1!==(e=o.indexOf("Firefox"))?(t="Firefox",n=o.substring(e+8)):-1!==(e=o.indexOf("MicroMessenger"))?(t="weixin",n=o.substring(e+15,e+20)):-1!==(e=o.indexOf("QQ"))?(t="qqbrowser",n=o.substring(e+3,e+8)):-1!==(e=o.indexOf("Opera"))&&(t="Opera",n=o.substring(e+6),-1!==(e=o.indexOf("Version")))&&(n=o.substring(e+8)),{browser:t,browser_version:n=-1!==(o=(n=-1!==(o=(n=-1!==(o=n.indexOf(";"))?n.substring(0,o):n).indexOf(" "))?n.substring(0,o):n).indexOf(")"))?n.substring(0,o):n}},le.prototype.os=function(){var e,t,n="";if(!F()){for(var o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows",r:/(Windows|Windows NT)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],i=0;i<o.length;i++){var r=o[i];if(r.r.test(this.userAgent)){"Mac OS X"===(n=r.s)&&this.isNewIpad()&&(n="iOS");break}}var a=function(e,t){e=e.exec(t);return e&&e[1]?e[1]:""},s=function(e,t){e=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:".concat(e,")"),"i").exec(t);return e?e.slice(1)[0]:""};switch(/Windows/.test(n)&&(e=a(/Windows (.*)/,n),n="windows"),n){case"Mac OS X":e=s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),n="mac";break;case"Android":e=a(/Android ([\.\_\d]+)/,t=this.userAgent)||a(/Android\/([\.\_\d]+)/,t),n="android";break;case"iOS":e=this.isNewIpad()?s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(e=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?"".concat(e[1],".").concat(e[2],".").concat(0|e[3]):"",n="ios"}}return{os_name:n,os_version:e}},le.prototype.getDeviceModel=function(e){var t,n,o="";try{"android"===e?navigator.userAgent.split(";").forEach(function(e){-1<e.indexOf("Build/")&&(o=e.slice(0,e.indexOf("Build/")))}):"ios"!==e&&"mac"!==e&&"windows"!==e||(o=this.isNewIpad()?"iPad":-1===(n=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"))?"":t.slice(0,n))}catch(e){}return o.trim()},le.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},le),ce={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az24z1mz1jz1az1cz18z1nz1nz1jz1mz1ez4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},m="5.2.1_tob";function le(e,t,n){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=n}function ue(e,t){this._storage=t&&"session"===t?ae:!e&&re.isSupportLS?re:new oe}var y,he={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},pe="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-core.js",l=((t=A=A||{}).Init="init",t.Config="config",t.Start="start",t.ReStart="re-start-sdk",t.Stop="stop-sdk",t.Ready="ready",t.CloudReady="cloud-ready",t.TokenComplete="token-complete",t.TokenStorage="token-storage",t.TokenFetch="token-fetch",t.TokenError="token-error",t.ConfigUuid="config-uuid",t.ConfigWebId="config-webid",t.ConfigDomain="config-domain",t.CustomWebId="custom-webid",t.AnonymousId="anonymous-id",t.TokenChange="token-change",t.TokenReset="token-reset",t.ConfigTransform="config-transform",t.EnvTransform="env-transform",t.SessionReset="session-reset",t.SessionResetTime="session-reset-time",t.Event="event",t.Events="events",t.EventNow="event-now",t.CleanEvents="clean-events",t.BeconEvent="becon-event",t.SubmitBefore="submit-before",t.SubmitScuess="submit-scuess",t.SubmitAfter="submit-after",t.SubmitError="submit-error",t.SubmitVerifyH="submit-verify-h5",t.BindToken="bind-token",t.BindTokenReady="bind-token-ready",t.CustomHeader="custom-request-header",t.Stay="stay",t.ResetStay="reset-stay",t.StayReady="stay-ready",t.SetStay="set-stay",t.RouteChange="route-change",t.RouteReady="route-ready",t.Ab="ab",t.AbVar="ab-var",t.AbAllVars="ab-all-vars",t.AbConfig="ab-config",t.AbExternalVersion="ab-external-version",t.AbVersionChangeOn="ab-version-change-on",t.AbVersionChangeOff="ab-version-change-off",t.AbOpenLayer="ab-open-layer",t.AbCloseLayer="ab-close-layer",t.AbReady="ab-ready",t.AbComplete="ab-complete",t.AbTimeout="ab-timeout",t.Profile="profile",t.ProfileSet="profile-set",t.ProfileSetOnce="profile-set-once",t.ProfileUnset="profile-unset",t.ProfileIncrement="profile-increment",t.ProfileAppend="profile-append",t.ProfileClear="profile-clear",t.TrackDuration="track-duration",t.TrackDurationStart="track-duration-start",t.TrackDurationEnd="track-duration-end",t.TrackDurationPause="track-duration-pause",t.TrackDurationResume="tracl-duration-resume",t.Autotrack="autotrack",t.AutotrackReady="autotrack-ready",t.SetExposureType="set-exposure-type",t.CepReady="cep-ready",t.TracerReady="tracer-ready",t.EncryptData="encrypt-data",t.LogSettingReady="logsetting-ready",t.SetResource="set-resource",(t=y=y||{}).DEBUGGER_MESSAGE="debugger-message",t.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",t.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",t.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",t.DEBUGGER_MESSAGE_EVENT="debugger-message-event",t.DEVTOOL_WEB_READY="devtool-web-ready",A),i=void 0,t=(new Date).getTimezoneOffset(),fe=parseInt("".concat(-t/60),10),de=60*t,ge=(n.prototype.initDomain=function(){var e=this.initConfig.channel_domain;e?this.domain=e:(e=this.initConfig.channel,this.domain=j(ce[e]))},n.prototype.setDomain=function(e){this.domain=e},n.prototype.getDomain=function(){return this.domain},n.prototype.getCommonInfo=function(e){return e?this.commonInfo[e]||"":this.commonInfo},n.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_".concat(this.initConfig.app_id),n=null;n=this.initConfig.ab_cross?(e=this.localStorage.getCookie(t,this.initConfig.ab_cookie_domain))?JSON.parse(e):null:this.localStorage.getItem(t),this.setAbCache(n)},n.prototype.setAbCache=function(e){this.ab_cache=e},n.prototype.getAbCache=function(){return this.ab_cache},n.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},n.prototype.setAbVersion=function(e){this.ab_version=e},n.prototype.getAbVersion=function(){return this.ab_version},n.prototype.getUrl=function(e){var t="";switch(e){case"event":t="/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid";break;case"profile":t="/profile/list";break;case"img":t="/gif";break;case"bind":t="/service/2/id_bind"}e="";return this.initConfig.caller&&(e="?sdk_version=".concat(m,"&sdk_name=web&app_id=").concat(this.initConfig.app_id,"&caller=").concat(this.initConfig.caller)),(this.initConfig.report_url?"".concat(this.initConfig.report_url):"".concat(this.getDomain()).concat(t)).concat(e)},n.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data){this.envInfo.header.custom[t]=e.latest_data[t];var n={};n["".concat(t)]=e.latest_data[t],this.set(n)}},n.prototype.changeReferInfo=function(e){var t=e,n=(this.set({referrer:t.referrer}),"");try{n=new URL(t.referrer).host}catch(e){}this.set({referrer_host:n||this.envInfo.header.referrer_host})},n.prototype.set=function(i){var r=this;Object.keys(i).forEach(function(e){var t,n,o;null==i[e]&&r.delete(e),"traffic_type"===e&&r.isLast&&(r.envInfo.header.custom.$latest_traffic_source_type=i[e]),"evtParams"===e?r.evtParams=u(u({},r.evtParams||{}),i.evtParams||{}):"_staging_flag"===e?r.evtParams=u(u({},r.evtParams||{}),{_staging_flag:i._staging_flag}):"reportErrorCallback"===e&&"function"==typeof i[e]?r.reportErrorCallback=i[e]:(o=n="",-1<e.indexOf(".")&&(n=(t=e.split("."))[0],o=t[1]),n?"user"===n||"header"===n?r.envInfo[n][o]=i[e]:(r.envInfo.header.custom[o]=i[e],r.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 添加了Custom",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"})):Object.hasOwnProperty.call(r.envInfo.user,e)?(-1<["user_type","ip_addr_id"].indexOf(e)?r.envInfo.user[e]=i[e]&&Number(i[e]):-1<["user_id","web_id","user_unique_id","user_unique_id_type","anonymous_id"].indexOf(e)?r.envInfo.user[e]=i[e]&&String(i[e]):-1<["user_is_auth","user_is_login"].indexOf(e)?r.envInfo.user[e]=Boolean(i[e]):"device_id"===e&&(r.envInfo.user[e]=i[e]),r.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 修改了公共参数",level:"info",time:Date.now(),infoType:"sdk",secType:"USER",common:e})):Object.hasOwnProperty.call(r.envInfo.header,e)?(r.envInfo.header[e]=i[e],r.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 修改了公共参数",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:e})):(r.envInfo.header.custom[e]=i[e],r.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 添加了Custom",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"})))})},n.prototype.getSettingData=function(e){if(this.logSettingConfig&&!L(this.logSettingConfig[e]))return this.logSettingConfig[e]},n.prototype.setSettingData=function(e){this.logSettingConfig=e},n.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},n.prototype.setStore=function(e){try{var t,n;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length&&(n=Object.assign(e,t),this.storage.setItem(this.configKey,n))}catch(e){console.log("setStore error"),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},n.prototype.getStore=function(){try{var e;return this.configPersist?(e=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length?e:null:null}catch(e){return this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),null}},n.prototype.delete=function(e){try{var t;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},n),me=(be.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+e)},be.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"]")+" "+e)},be.prototype.error=function(e){this.isLog&&console.error("[instance: ".concat(this.name,"]")+" "+e)},be.prototype.throw=function(e){throw this.error(this.name),new Error(e)},be),ye=((A=_e.prototype).bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),AppLogBridge.osName?this.os=AppLogBridge.osName():this.os=this.os,!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},A.bridgeReady=function(){var e=this;return new Promise(function(t,n){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):n(!1)}):n(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),n(!1)}})},A.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},A.setConfig=function(t){var n=this;try{Object.keys(t).forEach(function(e){"user_unique_id"===e?n.setUserUniqueId(t[e]):t[e]?n.addHeaderInfo(e,t[e]):n.removeHeaderInfo(e)})}catch(t){console.error("setConfig error")}},A.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},A.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},A.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},A.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},A.reportPv=function(e){this.onEventV3("predefine_pageview",e)},A.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t)}catch(e){console.error("onEventV3 error")}},A.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},A.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},A.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},A.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},A.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},A.setExternalAbVersion=function(e){try{AppLogBridge.setExternalAbVersion(e)}catch(e){console.error("setExternalAbVersion error")}},A.getVar=function(e,t,n){try{"harmonyos"===this.os||"android"===this.os?n(AppLogBridge.getABTestConfigValueForKey(e,t)):AppLogBridge.getABTestConfigValueForKey(e,t,function(e){n(e)})}catch(e){console.error("getVar error"),n(t)}},A.getAllVars=function(t){try{"harmonyos"===this.os||"android"===this.os?t(AppLogBridge.getAllAbTestConfigs()):AppLogBridge.getAllAbTestConfigs(function(e){t(e)})}catch(e){console.error("getAllVars error"),t(null)}},A.getAbSdkVersion=function(t){try{"harmonyos"===this.os||"android"===this.os?t(AppLogBridge.getAbSdkVersion()):AppLogBridge.getAbSdkVersion(function(e){t(e)})}catch(e){console.error("getAbSdkVersion error"),t("")}},_e),ve={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function _e(e,t){this.native=e.enable_native||e["evitaN".split("").reverse().join("")],this.os=t.get("os_name")}function be(e,t){this.isLog=t||!1,this.name=e||""}function n(e,t){var n=this,e=(this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e,new se(t.app_id,t.cookie_domain||"",t.cookie_expire||7776e6).init()),o=(this.commonInfo=e,"__tea_cache_first_".concat(t.app_id)),t=(this.configKey="__tea_cache_config_".concat(t.app_id),this.sessionStorage=new g(!1,"session"),this.localStorage=new g(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(o));t&&1==t?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(o,"1")),this.envInfo={user:{user_unique_id:i,user_type:i,user_id:i,user_is_auth:i,user_is_login:i,device_id:i,web_id:i,ip_addr_id:i,user_unique_id_type:i,anonymous_id:i},header:{app_id:i,app_name:i,app_install_id:i,install_id:i,app_package:i,app_channel:i,app_version:i,ab_version:i,os_name:e.os_name,os_version:e.os_version,device_model:e.device_model,ab_client:i,traffic_type:i,client_ip:i,device_brand:i,os_api:i,access:i,language:e.language,region:i,app_language:i,app_region:i,creative_id:e.utm.creative_id,ad_id:e.utm.ad_id,campaign_id:e.utm.campaign_id,log_type:i,rnd:i,platform:e.platform,sdk_version:m,sdk_lib:"js",province:i,city:i,timezone:fe,tz_offset:de,tz_name:i,sim_region:i,carrier:i,resolution:"".concat(e.screen_width,"x").concat(e.screen_height),browser:e.browser,browser_version:e.browser_version,referrer:e.referrer,referrer_host:e.referrer_host,width:e.screen_width,height:e.screen_height,screen_width:e.screen_width,screen_height:e.screen_height,utm_term:e.utm.utm_term,utm_content:e.utm.utm_content,utm_source:e.utm.utm_source,utm_medium:e.utm.utm_medium,utm_campaign:e.utm.utm_campaign,tracer_data:JSON.stringify(e.utm.tracer_data),custom:{},wechat_unionid:i,wechat_openid:i}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(e),this.initDomain(),this.initABData(),this.collect.on("route-change",function(e){n.changeReferInfo(e.config)})}function Ee(e,n,t,o,i,r,a,s,c,l){try{var u,h;window.XDomainRequest&&Y()?(u=new XDomainRequest,h=s||"post",u.open(h,e),t&&(u.timeout=t,u.ontimeout=function(){r&&r(n,ve.TIMEOUT)}),u.onerror=function(){u.abort(),r&&r(n,ve.XHR_ON)},u.onload=function(){if(i){var t=null;if(u.responseText){try{t=JSON.parse(u.responseText)}catch(e){t={}}i(t,n)}}},setTimeout(function(){u.send(JSON.stringify(n))},0)):window.ActiveXObject&&Z()?(u=new ActiveXObject("Micrsorf.XMLHTTP"),h=s||"POST",u.open(h,e),t&&(u.timeout=t,u.ontimeout=function(){r&&r(n,ve.TIMEOUT)}),u.onerror=function(){u.abort(),r&&r(n,ve.XHR_ON)},u.onload=function(){if(i){var t=null;if(u.responseText){try{t=JSON.parse(u.responseText)}catch(e){t={}}i(t,n)}}},setTimeout(function(){u.send(JSON.stringify(n))},0)):window.XMLHttpRequest&&(u=new XMLHttpRequest,h=s||"POST",u.open(h,e,!0),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&u.setRequestHeader("X-MCS-AppKey","".concat(a)),o&&(u.withCredentials=!0),t&&(u.timeout=t,u.ontimeout=function(){r&&r(n,ve.TIMEOUT)}),u.onreadystatechange=function(){if(4===u.readyState&&200===u.status&&i){var t=null;if(u.responseText){try{t=JSON.parse(u.responseText)}catch(e){t={}}i(t,n)}}},u.onerror=function(){u.abort(),r&&r(n,ve.XHR_ON)},u.send(JSON.stringify(n)))}catch(e){console.log(e.message)}}function Se(n,o,i,r){try{o.forEach(function(e){var e=(e=>{var t,n="";for(t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(n+="&".concat(t,"=").concat(encodeURIComponent(JSON.stringify(e[t]))));return"&"===n.slice(0,1)?n.slice(1):n})(e),t=new Image(1,1);t.onload=function(){t=null,i&&i()},t.onerror=function(){t=null,r&&r(n,o,4e3)},t.src="".concat(n,"?").concat(e)})}catch(i){r&&r(n,o,4002,i.message)}}function we(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function ke(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)}function Te(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null}v.prototype.apply=function(e,t){var n=this;this.collect=e,this.storage=new g(!1,"session"),this.sessionKey="__tea_session_id_".concat(t.app_id),this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(l.SessionReset,function(){n.resetSessionId()}),this.collect.on(l.SessionResetTime,function(){n.updateSessionIdTime()}))},v.prototype.updateSessionIdTime=function(){var e,t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(e=t.timestamp,Date.now()-e>this.expireTime?t={sessionId:we(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime())},v.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:we(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime)},v.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},v.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},v.prototype.resetSessionId=function(){var e={sessionId:we(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},v.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:we(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))};var De=v,Ae=(ze.prototype.handleMetaResource=function(e){var l=this;return Object.keys(this.metaResource).length&&e.forEach(function(e){var t=e.event,n=e.local_time_ms,o=e.params,i=u({},JSON.parse(o));try{for(var r in i)if(l.metaResource.hasOwnProperty(r)){var a,s=i[r],c=l.metaResource[r];c.length&&c.includes(s)&&(a=we(),i.ubt_source_id=a,l.eventCache.length&&(i.ubt_source=h([],f(l.eventCache)).reverse()),l.eventCache.length>=l.MAX_LEVEL&&l.eventCache.shift(),l.eventCache.push({event:t,params:u(u({},JSON.parse(o)),{ubt_source_id:a}),local_time_ms:n}));break}}finally{e.params=JSON.stringify(i)}}),e},ze),Oe=(c.prototype.apply=function(e,t){var n=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new g(!0),this.localStorage=new g(!1),this.trackId=new Ae(e,t),this.maxReport=t.max_report||20,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(this.configManager.get("app_id")),this.beconKey="__tea_cache_events_becon_".concat(this.configManager.get("app_id")),this.abKey="__tea_sdk_ab_version_".concat(this.configManager.get("app_id")),this.refer_key="__tea_cache_refer_".concat(this.configManager.get("app_id")),this.collect.on(l.Ready,function(){n.reportAll(!1)}),this.collect.on(l.ConfigDomain,function(){n.reportUrl=n.configManager.getUrl("event")}),this.collect.on(l.Event,function(e){n.event(e)}),this.collect.on(l.BeconEvent,function(e){n.beconEvent(e)}),this.collect.on(l.CleanEvents,function(){n.reportAll(!1)}),this.collect.on(l.BindTokenReady,function(){n.reportAll(!1)}),this.linster()},c.prototype.linster=function(){var e=this;P(window,"unload",function(){e.reportAll(!0)},!1),V(function(){e.reportAll(!0)}),P(document,"visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},c.prototype.reportAll=function(e){this.report(e),this.reportBecon()},c.prototype.event=function(e){var t=this;try{var n,o=this.cacheStorgae.getItem(this.eventKey)||[],i=h(h([],f(e)),f(o));this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport?this.report(!1):(n=this.reportTime,this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},n))}catch(e){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},c.prototype.beconEvent=function(e){var t;this.collect.destroyInstance||this.collect.sdkStop||(t=this.cacheStorgae.getItem(this.beconKey)||[],e=h(h([],f(e)),f(t)),this.cacheStorgae.setItem(this.beconKey,e),this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0)))},c.prototype.reportBecon=function(){var e;!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(e=this.cacheStorgae.getItem(this.beconKey)||[])&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},c.prototype.report=function(e){var t;!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},c.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var n=0;n<e.length;n+=this.eventLimit){var o=e.slice(n,n+this.eventLimit),i=this.split(this.merge(o));this.send(i,t)}else i=this.split(this.merge(e)),this.send(i,t)},c.prototype.merge=function(e,i){var r=this,t=this.configManager.get(),n=t.header,a=t.user,s=(n.custom.origin_referrer=null==(t=this.collect.configManager)?void 0:t.getCommonInfo("referrer"),n.custom.origin_referrer_host=null==(t=this.collect.configManager)?void 0:t.getCommonInfo("referrer_host"),n.custom=JSON.stringify(n.custom),this.configManager.get("evtParams")),c=this.configManager.get("user_unique_id_type"),t=[];try{var o=e.filter(function(t){try{Object.keys(s).length&&!i&&(t.params=u(u({},t.params),s)),r.collect.dynamicParamsFilter&&!i&&(e=r.collect.dynamicParamsFilter(),Object.keys(e).length)&&(t.params=u(u({},t.params),e)),c&&!i&&(t.params.$user_unique_id_type=c);var e,n=r.configManager.getAbCache(),o=r.configManager.getAbVersion();return o&&n&&(r.config.disable_ab_reset||n.uuid===a.user_unique_id)&&(t.ab_sdk_version=o),t.session_id=r.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),r.blockEvent(t.event)&&r.whiteEvent(t.event)}catch(e){return console.warn("filter merge event: ".concat(t&&t.event," error, pls check"),e&&e.message),r.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 处理Event数据异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"}),!1}});if(this.config.enable_track_id&&(o=this.trackId.handleMetaResource(o)),!Object.keys(a).length)return console.warn("user info error，cant report"),t;this.config.enable_anonymousid&&delete a.web_id;var l=JSON.parse(JSON.stringify({events:o,user:a,header:n}));l.local_time=Math.floor(Date.now()/1e3),l.verbose=1,l.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,t.push(l)}catch(e){console.warn("event merge error, pls check",e&&e.message)}return t},c.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},c.prototype.blockEvent=function(e){try{var t,n,o=this.blockList;return this.config.enable_logsetting&&(t=this.blockList,n=this.collect.configManager.getSettingData("blocklist_events")||[],o=t.concat(n.filter(function(e){return-1===t.indexOf(e)}))),!(o&&o.length&&o.includes(e))}catch(e){return!0}},c.prototype.whiteEvent=function(e){var t;try{return null==(t=this.whiteList)||!t.length||!!this.whiteList.includes(e)}catch(e){return!0}},c.prototype.send=function(e,s){var c=this;e.length&&e.forEach(function(e){try{var t,n,o,i=JSON.parse(JSON.stringify(e)),r=(c.config.filter&&!(i=c.config.filter(i))&&console.warn("filter must return data !!"),c.collect.eventFilter&&i&&((i=c.collect.eventFilter(i))||console.warn("filterEvent api must return data !!")),i||e),a=JSON.parse(JSON.stringify(r));r.length&&(t=!0,r.forEach(function(e){e.events.length||(t=!1)}),t)&&(c.collect.emit(l.SubmitBefore,r),n=c.collect.cryptoData(r),F()?Se(c.configManager.getUrl("img"),n):(o=L(c.collect.configManager.getSettingData("request_timeout"))?c.timeout:c.collect.configManager.getSettingData("request_timeout"),c.collect.requestManager.useRequest({url:c.reportUrl,data:r,success:function(e,t){e&&0!==e.e?(c.collect.emit(l.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),c.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:a,code:e.e,failType:"数据异常失败",status:"fail"})):(c.collect.emit(l.SubmitScuess,{eventData:t,res:e}),c.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:a,code:200,status:"success"}),c.updateFilter(e))},fail:function(e,t){c.configManager.get("reportErrorCallback")(e,t),c.collect.emit(l.SubmitError,{type:"f_net",eventData:e,errorCode:t}),c.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:a,code:t,failType:"网络异常失败",status:"fail"})},timeout:o,useBeacon:s,encryption:c.config.enable_encryption,encryption_header:c.config.encryption_header,zip:!0}),c.collect.emit(l.SubmitVerifyH,r),c.collect.emit(l.SubmitAfter,r)))}catch(e){console.warn("something error, ".concat(JSON.stringify(e.stack))),c.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK发送埋点发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}})},c.prototype.updateFilter=function(e){var t;this.blockList=(null==(t=null==e?void 0:e.blocklist)?void 0:t.v3)||[],this.whiteList=(null==(t=null==e?void 0:e.whitelist)?void 0:t.v3)||[]},c),Ie=(s.prototype.apply=function(e,t){var n=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new g(!1),this.tokenKey="__tea_cache_tokens_".concat(t.app_id),this.enableAnonymousid=t.enable_anonymousid,this.enableTTwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.timeout=t.timeout||3e5,this.collect.on(l.AnonymousId,function(e){n.setAnonymousId(e)}),this.collect.on(l.ConfigUuid,function(e){n.setUuid(e)}),this.collect.on(l.ConfigWebId,function(e){n.setWebId(e)}),this.collect.on(l.BindToken,function(e){n.fetchBind(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},s.prototype.checkStorage=function(){var e,t=this;this.enableCookie?(e=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid||this.enableAnonymousid?this.enableAnonymousid?this.completeAnonymous(this.cacheToken):this.enableCustomWebid?this.collect.on(l.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(l.TokenComplete)}):this.checkEnv()||(this.enableTTwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},s.prototype.check=function(){var e;this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?(e=this.getLocalId(),this.complete({web_id:e,user_unique_id:this.configManager.get("user_unique_id")||e})):this.remoteWebid()},s.prototype.checkEnv=function(){var e=window.navigator.userAgent;return(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram"))&&!(!(e=H(window.location.href))||!e.Web_ID||(this.complete({web_id:"".concat(e.Web_ID),user_unique_id:this.configManager.get("user_unique_id")||"".concat(e.Web_ID)}),0))},s.prototype.remoteWebid=function(){var o=this,e=this.configManager.getUrl("webid"),t={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},t=(this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:t}),this.collect.cryptoData(t));this.collect.requestManager.useRequest({url:e,data:t,success:function(e){var t,n;e&&0===e.e?(n=e.web_id,o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:e})):(t=o.getLocalId(),o.collect.configManager.set({localWebId:n=t}),o.collect.emit(l.TokenError),o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:e}),o.collect.logger.warn("appid: ".concat(o.config.app_id," get webid error, use local webid~"))),o.complete({web_id:o.configManager.get("web_id")||n,user_unique_id:o.configManager.get("user_unique_id")||n})},fail:function(){var e=o.getLocalId();o.complete({web_id:o.configManager.get("web_id")||e,user_unique_id:o.configManager.get("user_unique_id")||e}),o.collect.configManager.set({localWebId:e}),o.collect.emit(l.TokenError),o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),o.collect.logger.warn("appid: ".concat(o.config.app_id,", get webid error, use local webid~"))},timeout:this.timeout,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},s.prototype.getLocalId=function(){for(var e=ke(),t=0;0===e.indexOf("0")||0===e.indexOf("9");){if(10<=t){e=e.replace(/^(0|9)/,"");break}e=ke(),t++}return e},s.prototype.complete=function(e){var t=e.web_id,n=e.user_unique_id;t||n?(e.timestamp=Date.now(),0===t.indexOf("9")&&18<t.length?this.remoteWebid():(this.collect.configManager.set({web_id:t,user_unique_id:n}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(l.TokenComplete))):(this.collect.emit(l.TokenError),console.warn("token error"))},s.prototype.completeAnonymous=function(e){var t=e.anonymous_id||we(),n=e.user_unique_id||this.configManager.get("user_unique_id");this.collect.configManager.set({anonymous_id:t,user_unique_id:n||t}),e.anonymous_id=t,e.user_unique_id=n||t,this.setStorage(e),this.tokenReady=!0,this.collect.emit(l.TokenComplete)},s.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",n=this.configManager.get("user_unique_id");this.configManager.set({user_unique_id:n||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(l.TokenComplete)},s.prototype.setUuid=function(e){var t,n,o;e&&-1===["null","undefined","Null","None"].indexOf(e)?(t=String(e),n=this.configManager.get("user_unique_id"),o=this.cacheToken&&this.cacheToken.user_unique_id,t===n&&t===o||(this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(l.TokenChange,{type:"uuid",id:e}),this.collect.emit(l.ProfileClear),this.collect.emit(l.SessionReset))):this.clearUuid()},s.prototype.clearUuid=function(){var e;this.config.enable_ttwebid||(e=this.enableAnonymousid?this.configManager.get("anonymous_id"):this.configManager.get("web_id"),this.configManager.get("user_unique_id")!==e&&(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(l.ProfileClear),this.collect.emit(l.TokenReset)))},s.prototype.setAnonymousId=function(e){var t,n;e&&this.enableAnonymousid&&(t=this.configManager.get("anonymous_id"),n=this.configManager.get("user_unique_id"),t!==e)&&(t!==n&&n||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(l.TokenChange,{type:"uuid",id:e})),this.configManager.set({anonymous_id:e}),this.cacheToken.anonymous_id=e,this.collect.emit(l.TokenChange,{type:"anonymous_id",id:e}),this.setStorage(this.cacheToken))},s.prototype.setWebId=function(e){var t,n;!e||this.config.enable_ttwebid||this.enableAnonymousid||(t=this.configManager.get("web_id"),(n=this.configManager.get("user_unique_id"))&&n!==t||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(l.TokenChange,{type:"uuid",id:e})),t!==e&&(this.configManager.set({web_id:e}),this.cacheToken.web_id=e,this.collect.emit(l.ProfileClear),this.collect.emit(l.TokenChange,{type:"webid",id:e})),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken))},s.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enableTTwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},s.prototype.getReady=function(){return this.tokenReady},s.prototype.getTobId=function(t){var n=this,e={app_id:this.config.app_id,user_unique_id:this.configManager.get("user_unique_id"),user_unique_id_type:this.configManager.get("user_unique_id_type")},e=(this.enableAnonymousid?e.anonymous_id=this.configManager.get("anonymous_id"):e.web_id=this.configManager.get("web_id"),this.collect.cryptoData(e));this.collect.requestManager.useRequest({url:this.configManager.getUrl("tobid"),data:e,success:function(e){e&&0===e.e?(t(e.tobid),n.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"GetToken请求成功",logType:"fetch",level:"info",time:Date.now(),data:e,infoType:"sdk"})):(t(""),n.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"GetToken请求失败",logType:"fetch",level:"error",time:Date.now(),data:e,infoType:"sdk"}))},fail:function(){t(""),n.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"GetToken请求失败",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"})},time:this.timeout,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},s.prototype.fetchBind=function(e){var t=this,n=e.params,o=e.callback,e=this.configManager.getUrl("bind"),n={header:{aid:this.configManager.get("app_id"),identities:u({},n)}};this.collect.requestManager.useRequest({url:e,data:n,success:function(e){o(e),t.collect.sdkStop=!1,t.collect.emit(l.BindTokenReady)},fail:function(e){o(e),t.collect.sdkStop=!1,t.collect.emit(l.BindTokenReady)},time:3e4,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},s),Re=(Pe.prototype.setRequestHeader=function(e){this.customHeader=Object.assign(this.customHeader,e)},Pe.prototype.useFetch=function(e){var t=e.url,n=e.data,o=e.method,i=e.success,r=e.fail,a={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var s in this.customHeader)a[s]=this.customHeader[s];window.fetch?fetch(t,{method:o||"POST",headers:a,body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){i&&i(e)}).catch(function(e){r&&r(n,e)}):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:n,method:o,success:i,fail:r}))},Pe.prototype.useBeacon=function(e){var t=e.url,n=e.data,o=e.success,e=e.fail;window.navigator.sendBeacon(t,JSON.stringify(n))?o&&o():e&&e(n,this.errorCode.BEACON_FALSE)},Pe.prototype.useRequest=function(e){var n=this,t=e.url,o=e.data,i=e.method,r=e.success,a=e.fail,s=e.timeout,c=e.withCredentials,l=e.app_key,u=e.forceXhr,h=e.status;if(e.useBeacon&&this.supportBeacon)this.useBeacon({url:t,data:o,method:i,success:r,fail:a});else if("fetch"!==this.requestType||u)try{var p=null;if(window.XDomainRequest&&Y()){var p=new XDomainRequest,f=i||"post";p.open(f,t),s&&(p.timeout=s,p.ontimeout=function(){a&&a(o,n.errorCode.TIMEOUT)}),p.onerror=function(){p.abort(),a&&a(o,n.errorCode.XHR_ON)},p.onload=function(){if(r){var t=null;if(p.responseText){try{t=JSON.parse(p.responseText)}catch(e){t={}}r(t,o)}}},setTimeout(function(){p.send(JSON.stringify(o))},0)}else if(window.ActiveXObject&&Z())p=new ActiveXObject("Micrsorf.XMLHTTP"),f=i||"POST",p.open(f,t),s&&(p.timeout=s,p.ontimeout=function(){a&&a(o,n.errorCode.TIMEOUT)}),p.onerror=function(){p.abort(),a&&a(o,n.errorCode.XHR_ON)},p.onload=function(){if(r){var t=null;if(p.responseText){try{t=JSON.parse(p.responseText)}catch(e){t={}}r(t,o)}}},setTimeout(function(){p.send(JSON.stringify(o))},0);else if(window.XMLHttpRequest){if(p=new XMLHttpRequest,f=i||"POST",p.open(f,"".concat(t),!0),p.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&p.setRequestHeader("X-MCS-AppKey","".concat(l)),Object.keys(this.customHeader).length)for(var d in this.customHeader)p.setRequestHeader(d,this.customHeader[d]);c&&(p.withCredentials=!0),s&&(p.timeout=s,p.ontimeout=function(){a&&a(o,n.errorCode.TIMEOUT)}),p.onload=function(){if(r){var t=null;if(p.responseText){try{t=JSON.parse(p.responseText)}catch(e){t={}}r(t,o,h),n.collector.emit("http-ok",{data:o,status:h})}}},p.onerror=function(){a&&a(o,n.errorCode.XHR_ON),n.collector.emit("http-error",{data:o,status:h}),p.abort()},p.send(JSON.stringify(o))}}catch(e){this.collector.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK useRequest 发送请求发生了一些问题",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}else this.useFetch({url:t,data:o,method:i,success:r,fail:a})},Pe),Me=(a.prototype.apply=function(e,t){var n=this;F()||(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl="".concat(e.configManager.getDomain(),"/profile/list"),t=e.Types,e=e.adapters.fetch,this.fetch=e,this.cache={},this.collect.on(t.ProfileSet,function(e){n.setProfile(e)}),this.collect.on(t.ProfileSetOnce,function(e){n.setOnceProfile(e)}),this.collect.on(t.ProfileUnset,function(e){n.unsetProfile(e)}),this.collect.on(t.ProfileIncrement,function(e){n.incrementProfile(e)}),this.collect.on(t.ProfileAppend,function(e){n.appendProfile(e)}),this.collect.on(t.ProfileClear,function(){n.cache={}}),this.ready(t.Profile))},a.prototype.ready=function(e){var n=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var o=this.collect.hook._hooksCache[e];if(Object.keys(o).length)for(var t in o)(t=>{o[t].length&&o[t].forEach(function(e){n.collect.hook.emit(t,e)})})(t)}},a.prototype.report=function(e,t){void 0===t&&(t={});try{var n,o,i;this.config.disable_track_event||this.collect.sdkStop||((n=[]).push(this.collect.processEvent(e,t)),o=this.collect.eventManager.merge(n,!0),i=this.collect.cryptoData(o),this.collect.configManager.getUrl("profile"),this.collect.requestManager.useRequest({url:this.reportUrl,data:i,timeout:1e5,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header,zip:!0}),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_EVENT,info:"profile 埋点上报成功",time:Date.now(),data:o,code:200,status:"success"}))}catch(e){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"profile report 发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},a.prototype.setProfile=function(e){e=this.formatParams(e);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",u(u({},e),{profile:!0})))},a.prototype.setOnceProfile=function(e){e=this.formatParams(e,!0);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",u(u({},e),{profile:!0})))},a.prototype.incrementProfile=function(e){e?this.report("__profile_increment",u(u({},e),{profile:!0})):console.warn("please check the params, must be object!!!")},a.prototype.unsetProfile=function(e){var t;e?((t={})[e]="1",this.report("__profile_unset",u(u({},t),{profile:!0}))):console.warn("please check the key, must be string!!!")},a.prototype.appendProfile=function(e){if(e){var t,n={};for(t in e)"string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1)?n[t]=e[t]:console.warn("please check the value of param: ".concat(t,", must be string or array !!!"));Object.keys(n).length&&this.report("__profile_append",u(u({},n),{profile:!0}))}else console.warn("please check the params, must be object!!!")},a.prototype.pushCache=function(t){var n=this;Object.keys(t).forEach(function(e){n.cache[e]={val:n.clone(t[e]),timestamp:Date.now()}})},a.prototype.formatParams=function(n,o){var i=this;void 0===o&&(o=!1);try{if(n&&"[object Object]"===Object.prototype.toString.call(n)){var e,r={};for(e in n)"string"==typeof n[e]||"number"==typeof n[e]||"Array"===Object.prototype.toString.call(n[e]).slice(8,-1)?r[e]=n[e]:console.warn("please check the value of params:".concat(e,", must be string,number,Array !!!"));var a,t=Object.keys(r);if(t.length)return a=Date.now(),t.filter(function(e){var t=i.cache[e];return o?!t:!(t&&i.compare(t.val,n[e])&&a-t.timestamp<i.duration)}).reduce(function(e,t){return e[t]=r[t],e},{})}else console.warn("please check the params type, must be object !!!")}catch(n){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:n.message}),console.log("error")}},a.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),!1}},a.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}},a.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},a),xe=(Le.prototype.apply=function(e,t){var n;t.enable_logsetting?(this.collect=e,this.config=t,n=e.adapters.storage,this.setKey="__applog_web_logsetting_".concat(t.app_id),this.cacheStorgae=new n(!1),this.check()):e.emit(l.LogSettingReady)},Le.prototype.check=function(){var e=this.getLocalData();!e||!Object.keys(e).length||(null==e?void 0:e.timestamp)<Date.now()-this.expire?this.setting():(this.setLocalData(e),this.setting(!0))},Le.prototype.setting=function(e){var t=this;e?this.collect.emit(l.LogSettingReady):this.collect.requestManager.useRequest({url:"".concat(this.collect.configManager.getDomain()).concat(this.setUrl),data:{magic_tag:"ss_app_log",header:{aid:this.config.app_id,platform:"web"}},timeout:3e4,success:function(e){null!=e&&e.config&&t.setLocalData(e.config),t.collect.emit(l.LogSettingReady)},fail:function(){t.collect.emit(l.LogSettingReady)},encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})},Le.prototype.getLocalData=function(){return this.cacheStorgae.getItem(this.setKey)},Le.prototype.setLocalData=function(e){this.collect.configManager.setSettingData(e),this.cacheStorgae.setItem(this.setKey,e)},Le),Ce={autotrack:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/route.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},Ge=Te(),Be=(Ue.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},Ue.prototype.loadExtend=function(){var i=this;try{this.collect.remotePlugin.forEach(function(e,t){var n,o;"sdk"===e?Ce.hasOwnProperty(t)?(n=Ce[t].object,o="".concat(Ce[t].src[i.channel],"?query=").concat(Date.now()),i.exist(t,n,o)):console.warn("your ".concat(t," is not exist，please check plugin name")):"object"==typeof e&&(e.src?i.exist(t,e.call,e.src):i.process(t,e.instance,"INSTANCE"))})}catch(i){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),console.log("load extend error")}},Ue.prototype.exist=function(e,t,n){var o=this;Ge[t]?this.process(e,Ge[t]):this.loadPlugin(e,n,function(){o.process(e,Ge[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:".concat(e," success"),"-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:".concat(e," error"),"-")})},Ue.prototype.process=function(e,t,n){try{var o;n?((o=new t).apply&&o.apply(this.collect,this.config),console.log("excude ".concat(e," success"))):t&&t(this.collect,this.config)}catch(t){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("excude ".concat(e," error, message:").concat(t.message))}},Ue.prototype.loadPlugin=function(e,t,n,o){var i=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(n),r.onerror=function(){o(t)},r.onload=function(){i._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},Ue),Ne=(o.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, ".concat(e.message))}},o.prototype.parseUrl=function(){var t={};try{var e=window.location.href.split("?")[1].split("&");e.length&&e.forEach(function(e){e=e.split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])})}catch(t){}return t},o.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, ".concat(e.message))}},o.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_open_devtool_web");return e&&parseInt(e)===this.app_id},o.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_open_devtool_web",this.app_id)},o.prototype.loadDevTool=function(){this.loadScript(this.loadUrl)},o.prototype.loadBaseInfo=function(){var e,t;this.log=[],this.event=[],this.info=[{title:"基本信息",key:"base",type:1,content:[{name:"app_id",desc:"APP_ID",value:this.config.app_id},{name:"channel",desc:"CHANNEL",value:this.config.channel},{name:"domain",desc:"上报域名",value:this.collect.configManager.getDomain()},{name:"sdk_version",desc:"SDK版本",value:m},{name:"sdk_type",desc:"SDK引入方式",value:"script"}]},{title:"用户信息",key:"user",type:2,content:[{name:"uuid",desc:"UUID",value:this.collect.configManager.get("user").user_unique_id||""},{name:"web_id",desc:"WEB_ID",value:this.collect.configManager.get("user").web_id||""}]},{title:"公共参数信息",type:2,key:"common",content:[{name:"browser",desc:"浏览器",value:this.collect.configManager.get("browser")},{name:"browser_version",desc:"浏览器版本",value:this.collect.configManager.get("browser_version")},{name:"platform",desc:"平台",value:this.collect.configManager.get("platform")},{name:"device_model",desc:"设备型号",value:this.collect.configManager.get("device_model")},{name:"os_name",desc:"操作系统",value:this.collect.configManager.get("os_name")},{name:"os_version",desc:"操作系统版本",value:this.collect.configManager.get("os_version")},{name:"resolution",desc:"屏幕分辨率",value:this.collect.configManager.get("resolution")},{name:"referrer",desc:"来源",value:this.collect.configManager.get("referrer")},{name:"custom",desc:"自定义信息",value:JSON.stringify(this.collect.configManager.get("custom"))}]},{title:"配置信息",key:"config",type:3,content:[{name:"autotrack",desc:"全埋点",value:!!this.config.autotrack},{name:"stay",desc:"停留时长",value:!!this.config.enable_stay_duration}]},{title:"A/B配置信息",key:"ab",type:4,content:[{name:"ab",desc:"A/B实验",value:!!this.config.enable_ab_test}]}],this.config.enable_ab_test&&(t=this.getInfo("ab"),e=[{name:"ab",desc:"A/B实验",value:!!this.config.enable_ab_test},{name:"vid",desc:"已曝光VID",value:this.collect.configManager.getAbVersion()},{name:"ab_domain",desc:"A/B域名",value:this.config.ab_channel_domain||j(he[this.config.channel])},{name:"all_values",desc:"全部配置",value:this.collect.configManager.getAbCache()}],t.content=e,this.setInfo("ab",t)),(this.config.enable_native||this.config.Native)&&(e={title:"客户端信息",type:3,content:[{name:"native",desc:"是否打通",value:!!this.collect.bridgeReport}]},this.setInfo("native",e)),m.includes("tob")&&((t=this.getInfo("user")).content.push({name:"sid",desc:"DISS".split("").reverse().join(""),value:"点击获取"}),this.setInfo("user",t))},o.prototype.getInfo=function(t){var n=null;return this.info.forEach(function(e){e.key===t&&(n=e)}),n},o.prototype.setInfo=function(t,e){var n=!1;this.info.forEach(function(e){e.key===t&&(n=!0)}),n||this.info.push(e)},o.prototype.getSecondInfo=function(e,t){var e=this.getInfo(e),n=null;return e.content.forEach(function(e){e.name===t&&(n=e)}),n},o.prototype.setSecondInfo=function(e,t,n){var o,i=this.getInfo(e),r=!1;i.content.forEach(function(e){e.name===t&&(e.value=n,r=!0)}),r||(o={name:t,value:n,desc:t.toLocaleUpperCase()},i.content.push(o)),this.setInfo(e,i)},o.prototype.loadHook=function(){var o=this;this.collect.on(y.DEBUGGER_MESSAGE,function(t){switch(t.type){case y.DEBUGGER_MESSAGE_SDK:var e={time:t.time,type:t.logType||"sdk",infoType:t.infoType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(e.desc={content:JSON.stringify(t.data)}),o.updateLog(e),t.secType&&"AB"===t.secType?(o.setSecondInfo("ab","vid",o.collect.configManager.getAbVersion()),o.setSecondInfo("ab","all_values",o.collect.configManager.getAbCache())):"USER"===t.secType?o.setSecondInfo("user","user_unique_id"===t.common?"uuid":t.common,o.collect.configManager.get(t.common)):"HEADER"===t.secType&&(e=o.collect.configManager.get(t.common),o.setSecondInfo("common",t.common,"custom"===t.common?JSON.stringify(e):e)),void o.updateInfo();case y.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var e=t.data[0],n=e.events;if(!n.length)return;n.forEach(function(e){e.checkShow=!0,e.searchShow=!0,e.focusShow=!0,e.status=t.status,e.type=o.filterEvent.has(e.event)?"sdk":"cus",e.verifyType=t.verifyType?"verify":"no",e.info="","fail"===t.status&&(e.info={message:"code: ".concat(t.code,"， msg: ").concat(t.msg||t.failType)})}),o.updateEvent(e)}return}})},o.prototype.addLintener=function(){var t=this;window.addEventListener("message",function(e){if(e&&e.data&&"devtool:web:ready"===e.data.type){if(t.devToolOrigin=e.origin,t.devToolReady=!0,t.sendAlready)return;t.sendData("devtool:web:init",{info:t.info,log:t.log,event:t.event,sdk_type:m.includes("tob")?"tob":"inner",appId:t.app_id}),t.sendAlready=!0}e&&e.data&&"devtool:web:ssid"===e.data.type&&t.collect.getToken(function(e){t.setSecondInfo("user","sid",e.tobid),t.updateInfo()})})},o.prototype.sendData=function(e,t){try{var n={type:e,payload:t};window&&window.postMessage(n,this.devToolOrigin)}catch(e){}},o.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},o.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},o.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},o.prototype.loadDebuggerModule=function(){var e="#debugger-applog-web {\n      position: fixed;\n      width: 45px;\n      height: 45px;\n      background-image: url(".concat(j("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1bz1cz24z22z1mz1mz1jz4bz18z1nz1nz1jz1mz1ez4az1nz1lz1e"),");\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 45px;\n    }"),t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style"),e=(n.appendChild(document.createTextNode(e)),t.appendChild(n),document.createElement("div")),t=(e.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>',document.createElement("div")),n=(t.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(e),document.getElementsByTagName("body")[0].appendChild(t),document.getElementById("debugger-applog-web"));n&&n.addEventListener("click",function(){window&&window.postMessage({type:"devtool:web:open-draw"},location.origin)})},o);function o(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,t.enable_debug&&"Microsoft Internet Explorer"!==e.configManager.get("browser")&&(this.collect=e,this.config=t,this.app_id=t.app_id,e=e.adapters.storage,this.cacheStorgae=new e(!1),this.loadUrl=t.devtool_url||"https://lf-static.applogcdn.com/obj/applog-sdk-static/log-sdk/collect/devtool/debug-web.v2.0.0.js",this.filterEvent=new Set(["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"]),this.load())}function Ue(){}function Le(){this.setUrl="/service/2/log_settings",this.expire=216e5}function a(){}function Pe(e,t){var n=this;this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{},this.collector.on("custom-request-header",function(e){n.setRequestHeader(e)})}function s(){this.cacheToken={},this.enableCookie=!1,this.enableTTwebid=!1,this.enableCustomWebid=!1,this.enableAnonymousid=!1}function c(){this.eventLimit=50,this.eventCache=[],this.beconEventCache=[]}function ze(e,t){var n=this;this.MAX_LEVEL=3,this.metaResource={},this.eventCache=[],t.enable_track_id&&(this.MAX_LEVEL=t.track_level||3,e.on(l.SetResource,function(e){n.metaResource=e}))}function v(){}b.usePlugin=function(e,t,n){if(t){for(var o=!1,i=0,r=b.plugins.length;i<r;i++)if(b.plugins[i].name===t){b.plugins[i].plugin=e,b.plugins[i].options=n||{},o=!0;break}o||b.plugins.push({name:t,plugin:e,options:n})}else b.plugins.push({plugin:e})},b.prototype.usePlugin=function(e,t,n){e&&(this.remotePlugin.get(e)?console.info("your sdk version has ".concat(e," already ~")):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:n}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},b.prototype.init=function(e){var t,o=this;if(this.inited)console.log("init can be call only one time");else if(e&&N(e))if(e.app_id&&"number"==typeof(t=e.app_id)&&!isNaN(t))if(e.app_key&&"string"!=typeof e.app_key)console.warn("app_key param is error, must be string, please check!");else{if(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),e.channel="cn"),this.logger=new me(this.name,e.log),this.configManager=new ge(this,e),this.appBridge=new ye(e,this.configManager),this.bridgeReport=this.appBridge.bridgeInject(),this.requestManager=new Re(this,e),this.logSetting=new xe,this.debugger=new Ne(this,e),this.initConfig=e,this.env=e.channel_domain?"self":"public",this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Init",data:e,level:"info",time:Date.now(),infoType:"cus"}),e.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport)try{b.plugins.length&&b.plugins.reduce(function(e,t){var n=t.plugin;return"stay"!==(null==t?void 0:t.name)&&"autotrack"!==(null==t?void 0:t.name)||(t=Object.assign(o.initConfig,t.options),(n=new n).apply(o,t),e.push(n)),e},this.pluginInstances)}catch(e){console.log("load plugin error, ".concat(e.message)),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK加载插件发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}else this.configManager.set({app_id:e.app_id}),this.eventManager=new Oe,this.tokenManager=new Ie,this.sessionManager=new De,this.profileManager=new Me,this.extendManager=new Be,Promise.all([new Promise(function(e){o.once(l.TokenComplete,function(){e(!0)})}),new Promise(function(e){o.once(l.Start,function(){e(!0)})}),new Promise(function(e){o.once(l.LogSettingReady,function(){e(!0)})})]).then(function(){o.ready(e)}).catch(function(e){console.log(e)}),this.logSetting.apply(this,e),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e);this.inited=!0,this.emit(l.Init)}else console.warn("app_id param is error, must be number, please check!");else console.warn("init params error,please check")},b.prototype.ready=function(t){var i=this;try{this.extendManager.apply(this,this.initConfig),b.plugins.length&&b.plugins.reduce(function(e,t){var n=t.plugin,o=Object.assign(i.initConfig,t.options),n=new n;return n.apply(i,o),e.push(n),i.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK加载".concat(t.name,"插件"),level:"info",time:Date.now(),infoType:"sdk"}),e},this.pluginInstances)}catch(t){console.log("load plugin error, ".concat(t.message)),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK加载插件发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}this.sdkReady=!0,this.emit(l.Ready),this.emit(l.CloudReady,{userInfo:this.configManager.get("user")}),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 用户信息初始化完成",time:Date.now(),secType:"USER",level:"info",data:this.configManager.get("user"),infoType:"sdk"}),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:this.configManager.get("user"),infoType:"sdk"}),this.logger.info("appid: ".concat(t.app_id,", userInfo:").concat(JSON.stringify(this.configManager.get("user")))),this.logger.info("appid: ".concat(t.app_id,", sdk is ready, version is ").concat(m,", you can report now !!!")),this.profileManager.apply(this,t);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK发生了异常",level:"error",time:Date.now(),data:t.message,infoType:"sdk"})}this.pageView(),this.on(l.TokenChange,function(e){"webid"!==e.type&&"anonymous_id"!==e.type||i.pageView(),i.logger.info("appid: ".concat(t.app_id," token change, new userInfo:").concat(JSON.stringify(i.configManager.get("user")))),i.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user"),infoType:"sdk"})}),this.on(l.TokenReset,function(){i.logger.info("appid: ".concat(t.app_id," token reset, new userInfo:").concat(JSON.stringify(i.configManager.get("user")))),i.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user"),infoType:"sdk"})}),this.on(l.RouteChange,function(e){e.init||t.disable_route_report||i.pageView(e.config)}),this.on(l.ReStart,function(){i.pageView()})},b.prototype.config=function(e){var t,n;this.inited?e&&N(e)?this.bridgeReport?this.appBridge.setConfig(e):(e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv),t=u({},e),this.initConfig&&this.initConfig.configPersist&&((n=this.configManager.getStore())&&(t=Object.assign(n,e)),this.configManager.setStore(e)),t.web_id,t.user_unique_id,n=((e,t)=>{var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]]);return n})(t,["web_id","user_unique_id"]),t.hasOwnProperty("web_id")&&this.emit(l.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(l.ConfigUuid,t.user_unique_id),this.emit(l.ConfigTransform,t),this.configManager.set(n),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Config",level:"info",time:Date.now(),data:t,infoType:"cus"})):this.logger.warn("config params is error, please check"):this.logger.warn("config must be use after function init")},b.prototype.setUserUniqueID=function(e){this.config({user_unique_id:e})},b.prototype.setHeaderInfo=function(e,t){var n={};n[e]=t,this.config(n)},b.prototype.removeHeaderInfo=function(e){var t={};t[e]=void 0,this.config(t)},b.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(l.ConfigDomain)},b.prototype.getConfig=function(e){return this.configManager.get(e)},b.prototype.send=function(){this.start()},b.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(l.Start),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Start",level:"info",time:Date.now(),infoType:"cus"}),this.bridgeReport)&&(this.pageView(),this.emit(l.Ready))},b.prototype.event=function(e,t){var n=this;try{if(!this.initConfig||!this.initConfig.disable_track_event){var o=[];if(Array.isArray(e))e.forEach(function(e){e=n.processEvent(e[0],e[1]||{});e&&o.push(e)});else{var i=this.processEvent(e,t);if(!i)return;o.push(i)}this.bridgeReport?o.forEach(function(e){var t=e.event;n.appBridge.onEventV3(t,JSON.stringify(e.params))}):o.length&&(this.emit(l.Event,o),this.emit(l.SessionResetTime)),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Event",level:"info",time:Date.now(),data:e,infoType:"cus"})}}catch(e){this.logger.warn("something error, please check"),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Event发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},b.prototype.beconEvent=function(e,t){var n,o=this;this.initConfig&&this.initConfig.disable_track_event||(Array.isArray(e)?console.warn("beconEvent not support batch report, please check"):(n=[],(t=this.processEvent(e,t||{}))&&(n.push(t),this.bridgeReport?n.forEach(function(e){var t=e.event;o.appBridge.onEventV3(t,JSON.stringify(e.params))}):n.length&&(this.emit(l.BeconEvent,n),this.emit(l.SessionResetTime)),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行Beacon Event",level:"info",time:Date.now(),data:e,infoType:"sdk"}))))},b.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var n,o,i;return e?(/^event\./.test(n=e)&&(n=e.slice(6)),i=void((o="object"!=typeof(o=t)?{}:o).profile?delete o.profile:o.event_index=W+=1),o.local_ms?(i=o.local_ms,delete o.local_ms):i=+new Date,{event:n,params:o,local_time_ms:i,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}):(this.logger.warn("eventName is null， please check"),null)}catch(n){return this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK发生了异常",level:"error",time:Date.now(),data:n.message,infoType:"sdk"}),{event:e,params:t}}},b.prototype.dynamicParams=function(e){this.dynamicParamsFilter=e},b.prototype.filterEvent=function(e){this.eventFilter=e},b.prototype.on=function(e,t){this.hook.on(e,t)},b.prototype.once=function(e,t){this.hook.once(e,t)},b.prototype.off=function(e,t){this.hook.off(e,t)},b.prototype.emit=function(e,t,n){this.hook.emit(e,t,n)},b.prototype.set=function(e){this.hook.set(e)},b.prototype.pageView=function(e){this.disableAutoPageView||this.predefinePageView(e)},b.prototype.predefinePageView=function(e){var t;void 0===e&&(e={}),this.inited?(t={title:document.title||location.pathname,url:location.href,url_path:this.handlePath(),time:Date.now(),referrer:window.document.referrer,$is_first_time:"".concat(this.configManager&&this.configManager.is_first_time||!1)},t=u(u({},t),e),this.event("predefine_pageview",t),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 上报PV",level:"info",time:Date.now(),infoType:"sdk"})):console.warn("predefinePageView should call after init")},b.prototype.handlePath=function(){var e,t=location.pathname;try{if(this.initConfig.allow_hash)return(e=new URL(location.href).hash.match(/#\/([^?#]+)/i))&&e.length?e[1]:location.pathname}catch(e){t=location.pathname}return t},b.prototype.clearEventCache=function(){this.emit(l.CleanEvents)},b.prototype.setWebIDviaUnionID=function(e){var t;e&&(t=J(e),this.config({web_id:"".concat(t),wechat_unionid:e}),this.emit(l.CustomWebId))},b.prototype.setWebIDviaOpenID=function(e){var t;e&&(t=J(e),this.config({web_id:"".concat(t),wechat_openid:e}),this.emit(l.CustomWebId))},b.prototype.setAnonymousId=function(e){this.emit(l.AnonymousId,e)},b.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},b.prototype.setRequestHeaders=function(e){this.emit(l.CustomHeader,e)},b.prototype.resetStayDuration=function(e,t,n){this.emit(l.ResetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:n=void 0===n?"":n},l.Stay)},b.prototype.resetStayParams=function(e,t,n){this.emit(l.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:n=void 0===n?"":n},l.Stay)},b.prototype.getToken=function(n,e){var o,t,i,r=this;this.inited?(o=!1,t=function(e){var t;if(!o)return o=!0,t=r.configManager.get().user,e&&(t.tobid=e,t["diss".split("").reverse().join("")]=e),n(u({},t))},i=function(){r.tokenManager.getTobId(function(e){t(e)})},this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行GetToken",level:"info",time:Date.now(),infoType:"cus"}),this.sdkReady?i():(e&&setTimeout(function(){t()},e),this.on(l.Ready,function(){i()}))):this.logger.warn("getToken must be use after function init")},b.prototype.bindToken=function(e,t){},b.prototype.setResourceEvent=function(e){this.emit(l.SetResource,e)},b.prototype.startTrackEvent=function(e){e&&this.emit(l.TrackDurationStart,e,l.TrackDuration)},b.prototype.endTrackEvent=function(e,t){void 0===t&&(t={}),e&&this.emit(l.TrackDurationEnd,{eventName:e,params:t},l.TrackDuration)},b.prototype.pauseTrackEvent=function(e){e&&this.emit(l.TrackDurationPause,e,l.TrackDuration)},b.prototype.resumeTrackEvent=function(e){e&&this.emit(l.TrackDurationResume,e,l.TrackDuration)},b.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(l.ProfileSet,e,l.Profile),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e,infoType:"cus"})},b.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(l.ProfileSetOnce,e,l.Profile),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e,infoType:"cus"})},b.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(l.ProfileIncrement,e,l.Profile),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e,infoType:"cus"})},b.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(l.ProfileUnset,e,l.Profile),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e,infoType:"cus"})},b.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(l.ProfileAppend,e,l.Profile),this.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e,infoType:"cus"})},b.prototype.setExternalAbVersion=function(e){this.bridgeReport?this.appBridge.setExternalAbVersion(e):this.emit(l.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null,l.Ab)},b.prototype.getVar=function(e,t,n){this.bridgeReport?this.appBridge.getVar(e,t,n):this.emit(l.AbVar,{name:e,defaultValue:t,callback:n},l.Ab)},b.prototype.getAllVars=function(e){this.bridgeReport?this.appBridge.getAllVars(e):this.emit(l.AbAllVars,e,l.Ab)},b.prototype.getABconfig=function(e,t){this.emit(l.AbConfig,{params:e,callback:t},l.Ab)},b.prototype.getAbSdkVersion=function(e){if(!this.bridgeReport||!e)return this.configManager.getAbVersion()||"";this.appBridge.getAbSdkVersion(e)},b.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(l.AbVersionChangeOn,e,l.Ab),function(){t.emit(l.AbVersionChangeOff,e,l.Ab)}},b.prototype.offAbSdkVersionChange=function(e){this.emit(l.AbVersionChangeOff,e,l.Ab)},b.prototype.openOverlayer=function(){this.emit(l.AbOpenLayer,"",l.Ab)},b.prototype.closeOverlayer=function(){this.emit(l.AbCloseLayer,"",l.Ab)},b.prototype.initCrypto=function(){this.publicKey=this.initConfig.crypto_publicKey||"04BA9E229380DC0E41E10839B0C52A4763D3EDFE8903F3B8E81395523381E03AA995D295BD4A4088792E4785B224F7837EB4D2C7C05973C7AE8687A35ACAE470A0"},b.prototype.cryptoData=function(e){return e},b.prototype.stop=function(){this.sdkStop=!0},b.prototype.reStart=function(){this.sdkStop=!1,this.emit(l.ReStart)},b.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(l.TokenComplete))},b.prototype.destoryInstance=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(l.TokenComplete))},b.prototype.setExposureType=function(e){this.emit(l.SetExposureType,e)},b.plugins=[];var je,Ve,Ke,qe,_,t=b,He="__rangers_ab_style__";function b(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.adapters={},this.sdkReady=!1,this.name=e,this.hook=new X(this),this.logger=new me(e),this.remotePlugin=new Map,this.Types=l,this.adapters.fetch=Ee,this.adapters.storage=g}Ke=ee,qe=(()=>{try{return!!Symbol.iterator}catch(e){return!1}})(),(()=>{try{var e=Ke.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(e){}})()||((_=Qe.prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},_.delete=function(e){delete this._entries[e]},_.get=function(e){return e in this._entries?this._entries[e][0]:null},_.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},_.has=function(e){return e in this._entries},_.set=function(e,t){this._entries[e]=[String(t)]},_.forEach=function(e,t){for(var n in this._entries)if(this._entries.hasOwnProperty(n))for(var o=this._entries[n],i=0;i<o.length;i++)e.call(t,o[i],n,this)},_.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),We(n)},_.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),We(t)},_.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),We(n)},qe&&(_[Symbol.iterator]=_.entries),_.toString=function(){var n=[];return this.forEach(function(e,t){n.push(Xe(t)+"="+Xe(e))}),n.join("&")},Ke.URLSearchParams=Qe),"function"!=typeof(_=Ke.URLSearchParams.prototype).sort&&(_.sort=function(){var n=this,o=[];this.forEach(function(e,t){o.push([t,e]),n._entries||n.delete(t)}),o.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),n._entries&&(n._entries={});for(var e=0;e<o.length;e++)this.append(o[e][0],o[e][1])}),"function"!=typeof _._fromString&&Object.defineProperty(_,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var n=[];this.forEach(function(e,t){n.push(t)});for(var t=0;t<n.length;t++)this.delete(n[t])}for(var o,i=(e=e.replace(/^\?/,"")).split("&"),t=0;t<i.length;t++)o=i[t].split("="),this.append($e(o[0]),1<o.length?$e(o[1]):"")}});var E=ee;if((()=>{try{var e=new E.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){}})()||(je=E.URL,Ve=Fe.prototype,["hash","host","hostname","port","protocol"].forEach(function(e){var t;t=e,Object.defineProperty(Ve,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}),Object.defineProperty(Ve,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(Ve,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],e=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),Fe.createObjectURL=function(e){return je.createObjectURL.apply(je,arguments)},Fe.revokeObjectURL=function(e){return je.revokeObjectURL.apply(je,arguments)},E.URL=Fe),void 0!==E.location&&!("origin"in E.location)){var Je=function(){return E.location.protocol+"//"+E.location.hostname+(E.location.port?":"+E.location.port:"")};try{Object.defineProperty(E.location,"origin",{get:Je,enumerable:!0})}catch(e){setInterval(function(){E.location.origin=Je()},100)}}function Fe(e,t){"string"!=typeof e&&(e=String(e)),t&&"string"!=typeof t&&(t=String(t));var n=document;if(t&&(void 0===E.location||t!==E.location.href)){t=t.toLowerCase(),(i=(n=document.implementation.createHTMLDocument("")).createElement("base")).href=t,n.head.appendChild(i);try{if(0!==i.href.indexOf(t))throw new Error(i.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var o=n.createElement("a"),i=(o.href=e,i&&(n.body.appendChild(o),o.href=o.href),n.createElement("input"));if(i.type="url",i.value=e,":"===o.protocol||!/:/.test(o.href)||!i.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:o});var r=new E.URLSearchParams(this.search),a=!0,s=!0,c=this,l=(["append","delete","set"].forEach(function(e){var t=r[e];r[e]=function(){t.apply(r,arguments),a&&(s=!1,c.search=r.toString(),s=!0)}}),Object.defineProperty(this,"searchParams",{value:r,enumerable:!0}),void 0);Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==l&&(l=this.search,s)&&(a=!1,this.searchParams._fromString(this.search),a=!0)}})}function We(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return qe&&(e[Symbol.iterator]=function(){return e}),e}function Xe(e){return encodeURIComponent(e).replace(/%20/g,"+")}function $e(e){return decodeURIComponent(String(e).replace(/\+/g," "))}function Qe(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var t=typeof e;if("undefined"!=t)if("string"==t)""!==e&&this._fromString(e);else if(e instanceof Qe){var n=this;e.forEach(function(e,t){n.append(t,e)})}else{if(null===e||"object"!=t)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var o=0;o<e.length;o++){var i=e[o];if("[object Array]"!==Object.prototype.toString.call(i)&&2===i.length)throw new TypeError("Expected [string, any] as entry at index "+o+" of URLSearchParams's input");this.append(i[0],i[1])}else for(var r in e)e.hasOwnProperty(r)&&this.append(r,e[r])}}function Ye(e){e.length&&e.forEach(function(e){et.push(e)})}var Ze={},et=[];function tt(e,t,n,o){var i=e&&e.source||window.opener||window.parent,e=e&&e.origin||o||"*";i.postMessage(JSON.stringify({type:t,payload:n}),e)}function nt(e,t){Ze[e]=Ze[e]||[],Ze[e].push(t)}function ot(t){if(et.some(function(e){return"*"===e})||et.some(function(e){return-1<t.origin.indexOf(e)})){var e,n,o=t.data;if("string"==typeof t.data)try{o=JSON.parse(t.data)}catch(t){o=void 0}o&&(e=o.type,n=o.payload,Ze[e])&&Ze[e].forEach(function(e){"function"==typeof e&&e(t,n)})}}function it(e,t){var n={};if(Object.keys(e).length)for(var o in e){if("filter"===o||"autotrack"===o||"enable_stay_duration"===o)break;n[o]=e[o]}(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:n,version:t},"*"),window.addEventListener("message",ot,!1)}var rt,at="",st=!1;function ct(e){var t=e.event;st||(st=!0,Q(e.editorUrl,function(){tt(t,"abEditorScriptloadSuccess")},function(){t&&tt(t,"abEditorScriptloadError"),st=!1}))}(A=rt=rt||{})[A.Var=0]="Var",A[A.All=1]="All",S.prototype.apply=function(e,t){var n,o,i,r,a,s,c,l,u,h,p,f=this;this.collect=e,this.config=t,this.config.enable_ab_test&&(n=e.configManager.getSettingData("bav_ab_config"),U(n)&&!n||(o=t.enable_multilink,i=t.enable_ab_visual,r=t.ab_cross,a=t.ab_cookie_domain,s=t.disable_ab_reset,c=t.auto_exposure_expriment,l=t.ab_channel_domain||j(he[t.channel||"cn"]),h=(u=e.adapters).storage,u=u.fetch,this.cacheStorgae=new h(!1),this.fetch=u,this.enable_multilink=o,this.enable_ab_visual=i,this.abKey="__tea_sdk_ab_version_".concat(t.app_id),this.ab_cross=r,this.ab_cookie_domain=a||"",this.fetchUrl="".concat(l).concat("/service/2/abtest_config/"),this.reportUrl="".concat(e.configManager.getUrl("event")),this.exposureLimit=t.exposure_limit||5,this.ab_batch_time=t.ab_batch_time||50,this.overlay_opacity=t.overlay_opacity||0,this.auto_exposure=c,h=this.collect.Types,this.types=h,p=e.configManager.getSettingData("bav_ab_refresh"),this.collect.on(h.TokenChange,function(e){s||U(n)&&!p||"uuid"===e.type&&f.readyStatus&&(f.clearCache(),f.fetchAB())}),this.collect.on(h.TokenReset,function(){s||U(n)&&!p||f.readyStatus&&(f.clearCache(),f.fetchAB())}),this.collect.on(h.AbVar,function(e){var t=e.name;f.getVar(t,e.defaultValue,e.callback)}),this.collect.on(h.AbAllVars,function(e){f.getAllVars(e)}),this.collect.on(h.AbConfig,function(e){var t=e.params;f.getABconfig(t,e.callback)}),this.collect.on(h.AbExternalVersion,function(e){f.setExternalAbVersion(e)}),this.collect.on(h.AbOpenLayer,function(){f.openOverlayer()}),this.collect.on(h.AbCloseLayer,function(){f.closeOverlayer()}),this.collect.on(h.AbVersionChangeOn,function(e){f.changeListener.set(e,e)}),this.collect.on(h.AbVersionChangeOff,function(e){f.changeListener.get(e)&&f.changeListener.delete(e)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(h.AbReady)))},S.prototype.ready=function(e){var n=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var o=this.collect.hook._hooksCache[e];if(Object.keys(o).length)for(var t in o)(t=>{o[t].length&&o[t].forEach(function(e){n.collect.hook.emit(t,e)})})(t)}},S.prototype.loadMode=function(){var i,e,t=(()=>{try{return JSON.parse(atob(window.name))||void 0}catch(e){}})(),n="";t&&(e=t.scenario,t=t.href,e?(this.editMode=!0,n=e):!t||-1===t.indexOf("datatester")&&-1===t.indexOf("visual-editor")||(this.editMode=!0,n="visual-editor")),this.enable_ab_visual&&(((o,i)=>{window.TEAVisualEditor=window.TEAVisualEditor||{},Ye(["*"]);var e,r="",t=(it(i,m),"");try{var n=window.performance.getEntriesByType("resource");if(n&&n.length&&(n.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(t=e.name)}),t||document.currentScript&&(t=document.currentScript.src),t)&&(e=t.split("/"))&&e.length){for(var r="https:/",a=2;a<e.length&&a!==e.length-1;a++)r+="/".concat(e[a]);r="".concat(r,"/visual-ab-core")}}catch(o){}nt("tea:openVisualABEditor",function(e){var t,n=e.data;if("string"==typeof e.data)try{n=JSON.parse(e.data)}catch(e){n=void 0}n&&(t=n.lang,n.appId!==i.app_id?(tt(e,"appIdError"),console.error("abtest appid is not belong the page appid please check")):(n=n.version,at=(n&&(n=n?".".concat(n):".1.0.1",r)?"".concat(r).concat(n,".js?query="):"".concat(pe,"?query=")).concat(Date.now()),window.TEAVisualEditor.lang=t,window.TEAVisualEditor.__ab_domin=i.channel_domain||"",ct({event:e,editorUrl:at,collectInstance:o})))})})(this.collect,this.config),"visual-editor"===n)?this.collect.destoryInstace():this.enable_multilink&&(i=this.collect,e=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=e.app_id,nt("tea:openTesterEventInspector",function(e){var t,n,o=e.data;if("string"==typeof e.data)try{o=JSON.parse(e.data)}catch(e){o=void 0}o&&(t=o.referrer,n=o.lang,o=o.appId,window.TEAVisualEditor.__editor_ajax_domain=t||"",window.TEAVisualEditor.__ab_appId=o||"",window.TEAVisualEditor.lang=n||"",ct({event:e,editorUrl:"".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",".js?query=").concat(Date.now()),collectInstance:i}))}))},S.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,n=e.ab_ext_version,o=e.ab_version_multilink,e=e.data,i=this.checkFromUrl(),i=(i?this.mulilinkVersions.push(i):this.mulilinkVersions=o||[],this.extVersions=n||[],this.versions=t||[],this.data=e,this.versions.concat(this.extVersions));this.enable_multilink&&(i=i.concat(this.mulilinkVersions)),this.configVersions(i.join(","))},S.prototype.checkFromUrl=function(){var e=H(window.location.href);return e&&e.vid?e.vid:""},S.prototype.updateVersions=function(){var t=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(t=t.concat(this.mulilinkVersions)),this.configVersions(t.join(",")),this.updateABCache(),0<this.changeListener.size&&this.changeListener.forEach(function(e){"function"==typeof e&&e(t)})},S.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},S.prototype.getVar=function(e,t,n){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof n)throw new Error("callback must be a function");t={name:e,defaultValue:t,callback:n,type:rt.Var};this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用GetVar",level:"info",time:Date.now(),data:e,infoType:"cus"}),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(t,e):this.callbacks.push(t)},S.prototype.getRealVar=function(e,t){var n,o=e.name,i=e.defaultValue,e=e.callback,r=this.data;r?N(r[o])?(n=r[o].vid,"$ab_url"===t?this.mulilinkVersions.includes(n)||this.mulilinkVersions.push(n):this.versions.includes(n)||this.versions.push(n),this.updateVersions(),this.fechEvent(n,t,i),e(r[o].val),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK执行GetVar，并曝光了实验".concat(o),level:"info",time:Date.now(),data:r[o],infoType:"sdk"})):(e(i),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK执行GerVar默认回调",level:"info",time:Date.now(),data:this.data,infoType:"sdk"})):e(i)},S.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");e={callback:e,type:rt.All};this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用GetAllVars",level:"info",time:Date.now(),infoType:"cus"}),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(e):this.callbacks.push(e)},S.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 执行GetAllVars",level:"info",time:Date.now(),data:this.data,infoType:"sdk"})},S.prototype.exposureAll=function(e){try{if(Object.keys(e).length)for(var t in e){if("$ab_url"===t||"$ab_modification"===t)break;this.getRealVar({name:t,defaultValue:e[t].val,callback:function(){},type:rt.Var},t)}}catch(e){console.warn("exposure all expriment err",JSON.stringify(e.message))}},S.prototype.fechEvent=function(e,t,n){try{var o,i,r,a,s,c;this.config.disable_track_event||this.collect.sdkStop||e&&(i=(o=this.collect.configManager.get()).header,r=o.user,(a=this.getABCache())&&a.uuid&&a.uuid!==r.user_unique_id||(s={event:"abtest_exposure",ab_sdk_version:"".concat(e),params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?n:window.location.href}),local_time_ms:Date.now()},i.custom=JSON.stringify(i.custom),c={events:[s],user:r,header:i},this.reportExposure(c,t)))}catch(e){this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 发生了异常",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},S.prototype.reportExposure=function(e,t){this.exposureCache.push(e),this.report(t)},S.prototype.report=function(e){var t=this;try{var n=this.collect.cryptoData(this.exposureCache);F()?Se(this.collect.configManager.getUrl("img"),n):(this.collect.requestManager.useRequest({url:this.reportUrl,data:n,timeout:1e5,useBeacon:"$ab_url"===e,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header,zip:!0}),this.exposureCache.forEach(function(e){t.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_EVENT,info:"曝光埋点上报成功",time:Date.now(),data:[e],code:200,status:"success",infoType:"sdk"})}),this.exposureCache=[])}catch(e){console.log("ab report err",e)}},S.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},S.prototype.getABconfig=function(e,t){var n=Object.keys(e);n&&n.length&&this.collect.configManager.set(e),this.fetchAB(t)},S.prototype.get=function(e){var t;return this.ab_cross?(t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain))?JSON.parse(t):null:this.cacheStorgae.getItem(e)},S.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},S.prototype.remove=function(){this.ab_cross?this.cacheStorgae.removeCookie(this.abKey,this.ab_cookie_domain):this.cacheStorgae.removeItem(this.abKey)},S.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""},t=this.get(this.abKey)||t;return e?t[e]:t},S.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},S.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},S.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},S.prototype.openOverlayer=function(e){var t,n,o,i,r=this;n=this.overlay_opacity,document.getElementById(He)||(n="body { opacity: ".concat(n," !important; }"),o=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).id=He,i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),o.appendChild(i)),e&&(t=setTimeout(function(){r.closeOverlayer(),clearTimeout(t)},e))},S.prototype.closeOverlayer=function(){var e;(e=document.getElementById(He))&&e.parentElement.removeChild(e)},S.prototype.fetchComplete=function(t,e){var o=this;if(t&&"[object Object]"==Object.prototype.toString.call(t)){this.data=t,this.setAbCache(e);var i,r,n=[],e=(Object.keys(t).forEach(function(e){e=t[e].vid;e&&n.push(e)}),this.versions=this.versions.filter(function(e){return n.includes(e)}),t.$ab_url),a=t.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){var e=a.val;window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,Q("".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-loader.js","?query=").concat(Date.now()),function(){console.log("load visual render success")},function(){console.log("load visual render fail")}),o.closeOverlayer(),o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行可视化实验",level:"info",logType:"fetch",time:Date.now(),infoType:"sdk",data:{$ab_modification:a}})})}else e&&this.enable_multilink&&(this.mulilinkVersions=this.mulilinkVersions.filter(function(e){return n.includes(e)}),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行多链接实验",level:"info",logType:"fetch",time:Date.now(),infoType:"sdk",data:{$ab_url:e}}),i=e.val,r=e.vid,i)&&r&&this.getVar("$ab_url",i,function(){o.editMode||(i!==window.location.href?setTimeout(function(){if(!o.collect.destroyInstance){var e=-1===(e="".concat(i)).indexOf("http")?"https://".concat(e):e,t=q(e).host;try{var n=new URL(e);t!==location.host?n.searchParams.append("vid",r):window.history.replaceState("","",e),window.location.href=n.href}catch(t){window.location.href=e}}},100):o.closeOverlayer())});this.auto_exposure&&this.exposureAll(t),this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach(function(e){return o[e.type===rt.Var?"getRealVar":"getRealAllVars"](e,"")}),this.callbacks=[]},S.prototype.fetchAB=function(n){var o=this,e=this.collect.configManager.get(),t=e.header,e=e.user,i=(this.config.enable_anonymousid&&delete e.web_id,e.user_unique_id),e={header:u(u(u({aid:this.config.app_id},e||{}),t||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})},t=(this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:e,infoType:"sdk"}),this.collect.cryptoData(e));this.collect.requestManager.useRequest({url:this.fetchUrl,data:t,success:function(e){o.fetchStatus="complete",o.refreshFetchStatus="complete";var t=e.data;"success"===e.message?(o.fetchComplete(t,i),n&&n(t)):(o.fetchComplete(null,i),n&&n(null)),o.collect.emit(o.types.AbComplete,t),o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:t,infoType:"sdk"})},fail:function(){o.fetchStatus="complete",o.refreshFetchStatus="complete",o.fetchComplete(null,i),n&&n(null),o.collect.emit(o.types.AbTimeout),o.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now(),infoType:"sdk"})},timeout:this.config.ab_timeout||1e4,encryption:this.config.enable_encryption,encryption_header:this.config.encryption_header})};var lt=S;function S(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[],this.auto_exposure=!1}try{var ut=Te();ut&&(ut.LogAb=function(e,t){(new lt).apply(e,t)})}catch(u){console.log(u)}T.prototype.setParams=function(e,t,n){this.set_path=e,this.set_url=n,this.set_title=t},T.prototype.resetParams=function(e,t,n){this.url_path=e,this.url=n,this.title=t},T.prototype.enable=function(e,t,n){this.url_path=e||this.url_path,this.url=n||this.url,this.title=t||this.title,this.disableCallback=this.enablePageAlive(),this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params},T.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},T.prototype.sendEvent=function(e,t){t=(t=void 0===t?!1:t)?this.aliveDTime:Date.now()-this.sessionStartTime;t<0||t>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,u({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:t,is_support_visibility_change:K(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.customParmas)),this.sessionStartTime=Date.now(),this.resetParams(location.pathname,document.title,location.href))},T.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},T.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)},1e3)},T.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},T.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},T.prototype.enablePageAlive=function(){var e=this,t=(this.timerHandler=this.setUpTimer(),this.visibilitychange.bind(this)),n=this.beforeunload.bind(this);return P(document,"visibilitychange",t,!1),P(window,"pagehide",n,!1),function(){e.beforeunload(),z(document,"visibilitychange",t,!1),z(window,"beforeunload",n,!1),z(window,"pagehide",n,!1)}};var ht=T,pt=(k.prototype.setParams=function(e,t,n){this.set_path=e,this.set_url=n,this.set_title=t},k.prototype.resetParams=function(e,t,n){this.url_path=e,this.url=n,this.title=t},k.prototype.enable=function(e,t,n){this.url_path=e||this.url_path,this.url=n||this.url,this.title=t||this.title,this.disableCallback=this.enablePageClose()},k.prototype.disable=function(){this.disableCallback()},k.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params,this.resetParams(location.pathname,document.title,location.href)},k.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,u({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:K()},this.customParmas)),this.pageStartTime=Date.now(),this.resetData())},k.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},k.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),n=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",n),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",n),window.removeEventListener("pagehide",n)}},k),ft=(w.prototype.apply=function(e,t){var n=this;this.collect=e,this.config=t,this.config.enable_stay_duration&&(this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new ht(e,t),this.pageClose=new pt(e,t),e=this.collect.Types,this.collect.on(e.ResetStay,function(e){var t=e.url_path;n.resetStayDuration(t,e.title,e.url)}),this.collect.on(e.RouteChange,function(e){e.init||t.disable_route_report||n.resetStayDuration()}),this.collect.on(e.SetStay,function(e){var t=e.url_path;n.setStayParmas(t,e.title,e.url)}),this.enable(this.url_path,this.title,this.url),this.ready(e.Stay),this.collect.emit(e.StayReady))},w.prototype.ready=function(e){var n=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var o=this.collect.hook._hooksCache[e];if(Object.keys(o).length)for(var t in o)(t=>{o[t].length&&o[t].forEach(function(e){n.collect.hook.emit(t,e)})})(t)}},w.prototype.enable=function(e,t,n){this.pageAlive.enable(e,t,n),this.pageClose.enable(e,t,n)},w.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},w.prototype.setStayParmas=function(e,t,n){this.pageAlive.setParams(e=void 0===e?"":e,t=void 0===t?"":t,n=void 0===n?"":n),this.pageClose.setParams(e,t,n),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:n},infoType:"cus"})},w.prototype.reset=function(e,t,n){this.disable(),this.enable(e,t,n)},w.prototype.resetStayDuration=function(e,t,n){this.reset(e,t,n),this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:n},infoType:"sdk"})},w);function w(){}function k(e,t){var n=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?n.activeEndTime=Date.now():"visible"===document.visibilityState&&(n.activeEndTime&&(n.totalTime+=n.activeEndTime-n.activeStartTime,n.activeTimes+=1),n.activeEndTime=void 0,n.activeStartTime=Date.now())},this.beforeunload=function(){if(n.totalTime+=(n.activeEndTime||Date.now())-n.activeStartTime,n.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:n.totalTime,page_title:document.title||location.pathname}))}catch(e){}n.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),N(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}function T(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,N(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}try{var D=Te();D&&(D.LogStay=function(e,t){(new ft).apply(e,t)})}catch(u){console.log(u)}gt.prototype.apply=function(e,t){var n=this;this.collect=e,t.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),e=this.collect.Types,this.collect.on(e.SessionResetTime,function(){n.process()}))},gt.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},gt.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())};var A=gt,ut=(dt.prototype.apply=function(e,t){var n=this;this.collect=e,this.config=t,this.config.channel_domain||this.config.disable_track_event||this.config.disable_sdk_monitor||this.config.enable_encryption||(t=e.adapters.fetch,this.fetch=t,this.url=e.configManager.getUrl("event"),t=this.collect.Types,this.collect.on(t.Ready,function(){n.sdkOnload()}),this.collect.on(t.SubmitError,function(e){"f_data"===e.type&&n.sdkError(e.eventData,e.errorCode)}))},dt.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),n=t.header,o=t.user,i=n.app_id,r=n.app_name,a=n.sdk_version,s=o.web_id,c=o.anonymous_id,l={events:[{event:"onload",params:JSON.stringify({app_id:i,app_name:r||"",sdk_version:a,sdk_type:"script",sdk_config:this.config,sdk_desc:"TOB"}),local_time_ms:Date.now()}],user:{user_unique_id:this.config.enable_anonymousid?c:s},header:{}};setTimeout(function(){e.collect.requestManager.useRequest({url:e.url,data:[l],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},dt.prototype.sdkError=function(e,t){var n=this;try{var o=e[0],i=o.user,r=o.header,a=[],s=(e.forEach(function(e){e.events.forEach(function(e){a.push(e)})}),{events:a.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(i)}),local_time_ms:Date.now()}}),user:{user_unique_id:i.user_unique_id},header:{}});setTimeout(function(){n.collect.requestManager.useRequest({url:n.url,data:[s],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},dt);function dt(){}function gt(){var e=this;this.setInterval=function(){var n,o,i,r;e.clearIntervalFunc=(n=function(){e.isSessionhasEvent&&e.endCurrentSession()},o=e.sessionInterval,void 0===n&&(n=function(){}),void 0===o&&(o=1e3),i=Date.now()+o,r=window.setTimeout(function e(){var t=Date.now()-i;n(),i+=o,r=window.setTimeout(e,Math.max(0,o-t))},o),function(){window.clearTimeout(r)})},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}function mt(e,t){if(void 0===t&&(t="list"),e)if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return 1}else{if(["A","BUTTON"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return 1;if(e.hasAttribute&&St(e,"ss"))return 1}}var yt=function(e,t){return!!St(e,t)};function vt(e){for(var t=e;t&&!mt(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}var _t=function(e){var t;return e?(t="",e.textContent?t=e.textContent.trim():e.innerText&&(t=e.innerText.trim()),"input"!==e.tagName&&"INPUT"!==e.tagName?t:e.value||""):""};function bt(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return 1;if("HTML"===t.nodeName||"body"===t.nodeName)return;t=t.parentNode}}var Et=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},St=function(e,t){if("string"==typeof t)return Et(e,t);if($(t)){for(var n=!1,o=0;o<t.length;o++)if(Et(e,t[o])){n=!0;break}return n}},wt=function(e,t){var n={};if("string"==typeof t)Et(e,t)&&(n[t]=e.getAttribute(t));else if($(t))for(var o=0;o<t.length;o++)Et(e,t[o])&&(n[t[o]]=e.getAttribute(t[o]));return n},kt=(Ot.prototype.init=function(e){this.eventHandel=e;e=this.config.mode;this.addListener(e)},Ot.prototype.addListener=function(e){var n=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(e){var t=e.config;n.getPageViewEvent(t,e.name)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){n.beatEvent(n.beatTime)});var t=0,o=null,i=(window.addEventListener("scroll",function(){clearTimeout(o),o=setTimeout(i,500),t=document.documentElement.scrollTop||document.body.scrollTop}),function(){(document.documentElement.scrollTop||document.body.scrollTop)==t&&n.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})})}catch(e){}try{var r=window.performance&&window.performance.getEntriesByType("paint");r&&r.length?(new PerformanceObserver(function(e){e=e.getEntries(),e=e[e.length-1],e=e.renderTime||e.loadTime;n.statistics||(n.getPageLoadEvent(e),n.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){n.statistics||(n.getPageLoadEvent(r[0].startTime||0),n.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}},Ot.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},Ot.prototype.beatEvent=function(e){var t,n=this;try{this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(t=setInterval(function(){n.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},e)),V(function(){n.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),n.beatTime&&clearInterval(t)})}catch(e){}},Ot),Tt={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Dt=(At.prototype.getConfig=function(){return this.config},At.prototype.setConfig=function(e){return this.config=e},At);function At(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}function Ot(e,t,n){var o=this;this.clickEvent=function(e){((e,t)=>{if(1===e.nodeType&&(t.svg||!(e=>{if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,n=!1;t;)"svg"===t.tagName.toLowerCase()?n=!(t=null):t=t.parentElement;return n})(e))&&!["HTML","BODY"].includes(e.tagName.toUpperCase()))return"none"!==(e=e).style.display&&(mt(e,"container")||t.track_attr&&yt(e,t.track_attr)||!(t=e).children.length||(t=t.children,![].slice.call(t).some(function(e){return 0<e.children.length})))})(e.target,o.options)&&o.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){o.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){o.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&o.eventHandel({eventType:"dom",eventName:"beat"},u({beat_type:0},e)),o.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){o.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=n.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat,this.statistics=!1}function It(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var n=[],o=[];return t.forEach(function(e){var e=(e=>{if(null===e)return{str:"",index:0};var t=0,n=e.parentElement;if(n)for(var o=n.children,i=0;i<o.length&&o[i]!==e;i++)o[i].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),mt(e,"list")?"[]":""].join(""),index:t}})(e),t=e.str,e=e.index;n.unshift(t),o.unshift(e)}),{element_path:"/".concat(n.join("/")),positions:o}}function Rt(e,n,t,o){var a,i={},r=(()=>{var e,t;if(n)return t=(e=n.getBoundingClientRect()).width,{left:e.left,top:e.top,element_width:t,element_height:e.height}})(),s=(s=r,c=(u=void 0===(u=e)?{}:e).clientX,u=u.clientY,l=(s=void 0===s?{}:s).left,s=s.top,u=0<=u-s?u-s:0,{touch_x:Math.floor(0<=c-l?c-l:0),touch_y:Math.floor(u)}),c=r.element_width,l=r.element_height,u=s.touch_x,r=s.touch_y,s=It(n),h=s.element_path,s=s.positions,p=(p=vt(n),a=[],function e(t){n="",3===(o=t).nodeType?n=o.textContent.trim():o.dataset&&o.dataset.hasOwnProperty("teaTitle")||o.hasAttribute("ata-tea-title")?n=o.getAttribute("data-tea-title"):o.hasAttribute("title")?n=o.getAttribute("title"):"INPUT"===o.nodeName&&["button","submit"].includes(o.getAttribute("type"))?n=o.getAttribute("value"):"IMG"===o.nodeName&&o.getAttribute("alt")&&(n=o.getAttribute("alt"));var n,o=n.slice(0,200);if(o&&-1===a.indexOf(o)&&a.push(o),0<t.childNodes.length)for(var i=t.childNodes,r=0;r<i.length;r++)8!==i[r].nodeType&&e(i[r])}(p),a),f=window.performance.timing.navigationStart,d=Date.now()-f,s=s.map(function(e){return"".concat(e)}),g=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(g=window.TEAVisualEditor.getOriginXpath({xpath:h,positions:s})),i.element_path=g&&g.xpath||h,i.positions=g&&g.positions||s,o&&!o.text&&(i.texts=p,i.element_title=_t(n)),i.element_id=n.getAttribute("id")||"",i.element_class_name=n.getAttribute("class")||"",i.element_type=n.nodeType,i.element_width=Math.floor(c),i.element_height=Math.floor(l),i.touch_x=u,i.touch_y=r,i.page_manual_key="",i.elememt_manual_key="",i.since_page_start_ms=d,i.page_start_ms=f,i.page_path=location.pathname,i.page_host=location.host,t.track_attr&&yt(n,t.track_attr)){var m=wt(n,t.track_attr);for(y in m)i[y]=m[y]}if(t.custom_attr)try{if(yt(n,t.custom_attr)){var m=wt(n,t.custom_attr),y=decodeURIComponent(m[t.custom_attr]),v=JSON.parse(y);if(Object.keys(v))for(var _ in v)i[_]=v[_]}}catch(e){console.log("custom attr error")}h=vt(n);return"A"===h.tagName&&(i.href=h.getAttribute("href")),!1===t.src||"IMG"!==n.tagName||n.getAttribute("src").includes("base64")||(i.src=n.getAttribute("src")),i}function Mt(e,t,n,o,i){return u(u({event:e},Rt(t,n,o,i)),{is_html:1,page_key:window.location.href,page_title:document.title})}zt.prototype.handleEvent=function(e,t){try{if(bt(e.target))return null;var n="bav2b_click";switch(t){case"click":return n=this.eventName.click,Mt(n,e,e.target,this.options,this.ignore);case"change":return u(u({},Mt(n="bav2b_change",e,e.target,this.options)),((e,t)=>{try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}})(n,e.target));case"submit":return Mt(n="bav2b_submit",e,e.target,this.options)}}catch(e){return console.error(e),null}},zt.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t,n=window.sessionStorage&&window.sessionStorage.getItem("_tea_cache_duration");n&&(t=JSON.parse(n),e.refer_page_duration_ms=t?t.duration:""),e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error ".concat(JSON.stringify(e)))}return e},zt.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var n=e.lcp,o=window.performance.timing,i=o.loadEventEnd-o.navigationStart;t.page_init_cost_ms=parseInt(n||(0<i?i:0)),t.page_start_ms=o.navigationStart}catch(e){console.log("page_statistics event error ".concat(JSON.stringify(e)))}return t},zt.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error ".concat(JSON.stringify(e)))}return e},zt.prototype.handleExposureEvent=function(e,t){return bt(t.target)?null:((t=Mt(e.event||this.eventName.exposure,t,t.target||t,this.options,this.ignore)).$exposure_type=e.exposureType,this.options.exposure.callback?(e=this.options.exposure.callback(t))||Object.keys(e).length?e:(console.warn("exposure callback must return data!"),t):t)},zt.prototype.handleScrollEvent=function(e,t){t=Mt(e.event||this.eventName.scroll,t,t.target||t,this.options,this.ignore),t=Object.assign(t,e.params);if(!this.options.scroll.callback||(t=this.options.scroll.callback(t))||Object.keys(t).length)return t;console.warn("scroll callback must return data!")};var xt=zt,Ct=(Pt.prototype.send=function(e,t){var n=t.event;delete t.event,e&&"becon"===e.eventSend?this.collect.beconEvent(n,t):this.collect.event(n,t)},Pt.prototype.get=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,t)},Pt.prototype.post=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,t)},Pt),Gt="_TEA_VE_OPEN",Bt="_TEA_VE_APIHOST",Nt="lang",Ut="_VISUAL_EDITOR_V",Lt="_VISUAL_EDITOR_U";function Pt(e){this.collect=e}function zt(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"$bav2b_exposure",scroll:"$bav2b_slide"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName),t&&t.scroll&&t.scroll.eventName&&(this.eventName.scroll=t.scroll.eventName)}function jt(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||d.get(Nt),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||d.get(Bt),n=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||d.get(Ut),o=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||d.get(Lt),i=+new Date,r=new Date(18e5+i);d.set(Gt,"1",{expires:r}),d.set(Bt,t,{expires:r}),d.set(Lt,o,{expires:r}),d.set(Nt,e,{expires:r}),d.set(Ut,n||"",{expires:r})}catch(e){console.log("set cookie err")}}var Vt=!1;function Kt(e){var t=e.event,n=e.autoTrackInstance;Vt||(Vt=!0,Q(e.editorUrl,function(){tt(t,"editorScriptloadSuccess"),n.destroy()},function(){t&&tt(t,"editorScriptloadError"),Vt=!1}))}function qt(i,e){window.TEAVisualEditor=window.TEAVisualEditor||{};var r="",a="".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-editor-rangers.js","?query=").concat(Date.now()),s=(window.TEAVisualEditor.appId=e.app_id,e.channel_domain),c="";if(Ye(["*"]),s){var t,n="";try{var o=window.performance.getEntriesByType("resource");if(o&&o.length&&(o.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(n=e.name)}),n||document.currentScript&&(n=document.currentScript.src),n)&&(t=n.split("/"))&&t.length){c="https:/";for(var l=2;l<t.length&&l!==t.length-1;l++)c+="/".concat(t[l]);c&&c.indexOf("/5.0")&&(c=c.split("/5.0")[0]||c)}}catch(i){}}if(it(e,m),"1"===d.get(Gt)){o=(()=>{var e=d.get(Bt);try{e=JSON.parse(e)}catch(e){}return e})(),e="";o&&(window.TEAVisualEditor.__editor_ajax_domain=o,e=d.get(Lt)),Kt({event:null,editorUrl:e||a,autoTrackInstance:i}),jt()}else try{nt("tea:openVisualEditor",function(e){var t,n,o=e.data;if("string"==typeof e.data)try{o=JSON.parse(e.data)}catch(e){o=void 0}o&&(n=o.referrer,t=o.lang,n&&(window.TEAVisualEditor.__editor_ajax_domain=n),r=a,s&&(o=(n=o.version)?"/visual-editor-rangers-v".concat(n):"/visual-editor-rangers-v1.0.0",r=c?"".concat(c).concat(o,".js"):a,window.TEAVisualEditor.__editor_verison=n),window.TEAVisualEditor.__editor_url=r,window.TEAVisualEditor.lang=t,Kt({event:e,editorUrl:r,autoTrackInstance:i}),jt())}),window.TEAVisualEditor.openAutotrackEditor=function(){Kt({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:i})}}catch(i){console.log("receive message error")}try{nt("tea:openHeatMapCore",function(e){Kt({event:e,editorUrl:"".concat("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/heatmap-core",".js?query=").concat(Date.now()),autoTrackInstance:i})})}catch(i){console.log("openHeatMapCore error")}}I.prototype.init=function(){var e,t=this;if(window.MutationObserver)try{(this._instance=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&t.attributeChangeObserve(e),"childList"===e.type&&t.modifyNodeObserve(e)})}),document&&document.body)?(e=!1!==this.config.autotrack.exposure.attributes,this._instance.observe(document.body,{childList:!0,attributes:e,subtree:!0,attributeOldValue:!1})):console.warn("please use sdk api init after body element")}catch(t){console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")}else console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")},I.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},I.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove.bind(t))})},I.prototype.mapChild=function(e,t){var n=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),n.mapChild(e,t)})},I.prototype.exposureAdd=function(e,t){try{this._intersection&&this._intersection.exposureAdd(e,t)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},I.prototype.exposureRemove=function(e){try{this._intersection&&this._intersection.exposureRemove(e)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},I._exposure_observer=null;var O,Ht=I;function I(e,t){this._instance=null,this._intersection=e,this.config=t,this._intersection&&this.init()}(D=O=O||{})[D.EXPOSURE_ONCE=0]="EXPOSURE_ONCE",D[D.LIFECYCLE_SHOW_NEW=3]="LIFECYCLE_SHOW_NEW",D[D.RESUME_FORM_PAGE=6]="RESUME_FORM_PAGE",D[D.RESUME_FORM_BACK=7]="RESUME_FORM_BACK",D[D.NOT_EXPOSURE=-1]="NOT_EXPOSURE",R.prototype.buildObserver=function(){var r=this;if(R._observer_instance||!window.IntersectionObserver)return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null;for(var e=[],t=0;t<=1;t+=.01)e.push(t);e.push(1);try{R._observer_instance=new IntersectionObserver(function(e){e.forEach(function(t){var e,n=t.target.observeId,o=r.observeMap.get(n),i=(t.target,t.intersectionRatio);(o.intersectionRatio=i)<=.1&&(t.target.backStatus=!1),r.observeMap.set(n,o),i<r.ratio?(o.isIntersecting=!1,o.added=!1,o.exposured=!1,o.startTime=Date.now(),r.observeMap.set(n,o)):(o.added||(o.startTime=Date.now(),o.added=!0,o.isIntersecting=!0,r.timeLimit&&(e=setTimeout(function(){try{var e;o.isIntersecting&&!o.exposured&&r.observeMap.get(n)&&(e=r.observeMap.get(n).intersectionRatio,r.exposureEvent(t,e,n,o))}catch(e){console.log("IntersectionObserver setTimeout error，msg: ".concat(JSON.stringify(e)))}},r.timeLimit),o.wait=e),r.observeMap.set(n,o)),Date.now()-o.startTime>=r.timeLimit&&!o.exposured&&r.exposureEvent(t,i,n,o))})},{threshold:e})}catch(e){console.log("IntersectionObserver error，msg: ".concat(JSON.stringify(e)))}return R._observer_instance},R.prototype.exposureAdd=function(e,t){var n,t="mutation"===t?e.target:e,e=t.observeId,o=ke();e||this.observeMap.has(e)?(n=this.observeMap.get(e))&&t!==n.instance?(this.unobserve(t),this.observeMap.delete(e),t.observeId=o,t.visible=!1,this.observeMap.set(o,{instance:t.cloneNode(!0),isIntersecting:!1}),this.observe(t)):!0!==t.visible&&this.handleBoundingExposure(t):(t.observeId=o,t.visible=!1,this.observeMap.set(o,{instance:t.cloneNode(!0),isIntersecting:!1}),this.observe(t))},R.prototype.exposureRemove=function(e){this.observeMap.has(e.observeId)&&(this.observeMap.delete(e.observeId),this.unobserve(e),e.observeId="",e.visible=!1)},R.prototype.exposureEvent=function(e,t,n,o){if(t>=this.ratio){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===o.exposured)return;o.startWait&&clearTimeout(o.startWait);t=e.target.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:t,exposureType:this.getExposureType(e.target)},e),e.target.visible=!0,e.target.hasExposure=!0,o.startTime=Date.now(),o.exposured=!0}else o.startTime=Date.now(),o.exposured=!1;this.observeMap.set(n,o)},R.prototype.observe=function(e){this.instance&&this.instance.observe(e)},R.prototype.unobserve=function(e){this.instance&&this.instance.unobserve(e)},R.prototype.getExposureDomToExposure=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t.handleBoundingExposure(e)})},R.prototype.visibilitychange=function(){var e=this,t=null;"visible"===document.visibilityState?this.timeLimit?setTimeout(function(){e.getExposureDomToExposure()},this.timeLimit):this.getExposureDomToExposure():(clearTimeout(t),this.customType=void 0)},R.prototype.handleBoundingExposure=function(e){var t;this.getBoundingRatio(e)>=this.ratio&&(e.visible=!0,t=e.getAttribute&&e.getAttribute("data-exposure-event"),this.eventHandle({eventType:"dom",eventName:"exposure",event:t,exposureType:this.customType||O.RESUME_FORM_BACK},e))},R.prototype.getBoundingRatio=function(e){var e=e.getBoundingClientRect(),t=e.top,n=e.left,o=e.width,i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return 0<=t&&0<=n&&t<=r&&n<=i?(i<o?i:o)*(r-t)/(o*e.height):0},R.prototype.getExposureType=function(e){return e.visible?!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=O.RESUME_FORM_PAGE:this.exposureType=O.LIFECYCLE_SHOW_NEW:(e.hasExposure,!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=O.RESUME_FORM_PAGE:this.exposureType=O.EXPOSURE_ONCE),this.exposureType},R.prototype.addListen=function(){var i,r,a=this,e=(this.collect.on("set-exposure-type",function(e){a.customType=e}),this.visibilitychange.bind(this));return P(document,"visibilitychange",e,!1),window.addEventListener("hashchange",function(e){var t=a.hashMap.get(e.oldURL);t&&location.href===t.prev?(a.backStatus=!0,a.exposureType=O.RESUME_FORM_PAGE):(a.backStatus=!1,a.hashMap.set(location.href,{current:e.newURL,prev:e.oldURL}))}),this.collect.bridgeReport?(i=window.history.pushState,history.pushState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"function"==typeof history.onpushstate&&history.onpushstate({state:e});var o=i.call.apply(i,h([history,e],f(t)));return a.lastState=e,o},r=history.replaceState,history.replaceState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var o=r.call.apply(r,h([history,e],f(t)));return a.lastState=e,o}):this.collect.on("STATE_CHANGE",function(e){a.lastState=e}),window.addEventListener("popstate",function(e){e=e.state;e&&e.current&&a.lastState&&a.lastState.back&&e.current===a.lastState.back?(a.backStatus=!0,a.exposureType=O.RESUME_FORM_PAGE):a.backStatus=!1}),function(){z(document,"visibilitychange",e,!1)}},R._observer_instance=null,R._observer_map=new Map;var Jt,Ft=R,Wt=(Xt.prototype.initObserver=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t._intersection.exposureAdd(e,"intersect")})},Xt);function Xt(e,t,n){t.autotrack&&t.autotrack.exposure&&(this._intersection=new Ft(e,t,n),this._observer=new Ht(this._intersection,t),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure event, please update~"))}function R(e,t,n){var o=this;this.backStatus=!1,this.instance=this.buildObserver(),this.collect=e,this.observeMap=R._observer_map,t.autotrack.exposure.ratio?this.ratio=t.autotrack.exposure.ratio:0===t.autotrack.exposure.ratio?this.ratio=0:this.ratio=.5,this.timeLimit=t.autotrack.exposure.stay||0,this.exposureType=O.NOT_EXPOSURE,this.eventHandle=n,this.hashMap=new Map,this.backStatus=!1,this.lastState=null,this.collect.on("re-start-sdk",function(){o.visibilitychange()}),this.addListen()}(x=Jt=Jt||{})[x.SCROLL_UP=1]="SCROLL_UP",x[x.SCROLL_DOWN=2]="SCROLL_DOWN",x[x.SCROLL_LEFT=3]="SCROLL_LEFT",x[x.SCROLL_RIGHT=4]="SCROLL_RIGHT",x[x.NOT_SCROLL=-1]="NOT_SCROLL",en.prototype.addLinstenr=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-scroll]"),function(e){t.scrollHandle(e)})},en.prototype.mutation=function(){var t=this;if(window.MutationObserver)try{var e=new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&t.modifyNodeObserve(e)})});document&&document.body?e.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1}):console.warn("please use sdk api init after body element")}catch(t){console.log("your browser cannot support MutationObserver")}else console.log("your browser cannot support MutationObserver")},en.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e),t.mapChild(e,t.scrollHandle.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e,"remove"),t.mapChild(e,t.scrollHandle.bind(t))})},en.prototype.mapChild=function(e,t){var n=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t(e),n.mapChild(e,t)})},en.prototype.scrollHandle=function(s,e){var c=this;try{var l=s.scrollTop,u=s.scrollLeft,t=null,h=0,p=0,n=function(o){clearTimeout(t),t=setTimeout(function(){var e=s.scrollTop,t=s.scrollLeft,n=o.target&&o.target.getAttribute("data-scroll-event")||"";1===a||2===a?e===i&&(p=i-l,Math.abs(p)>=c.distance)&&c.distance&&c.eventHandle({eventType:"dom",eventName:"scroll",event:n,params:{$direction:a,$offsetY:p,$offsetX:h}},o):3!==a&&4!==a||t===r&&(h=r-u,Math.abs(h)>=c.distance)&&c.distance&&c.eventHandle({eventType:"dom",eventName:"scroll",event:n,params:{$direction:a,$offsetY:p,$offsetX:h}},o),l=i,u=r},100);var i=s.scrollTop,r=s.scrollLeft,a=Jt.NOT_SCROLL;l<i?a=Jt.SCROLL_DOWN:i<l?a=Jt.SCROLL_UP:u<r?a=Jt.SCROLL_LEFT:r<u&&(a=Jt.SCROLL_RIGHT)};return"remove"===e?s.removeEventListener("scroll",n,!1):s.addEventListener("scroll",n,!1),function(){s.removeEventListener("scroll",n,!1)}}catch(s){console.warn("scroll event error",JSON.stringify(s))}};var $t=en,Qt={hashTag:!1,impr:!1},Yt=(Zt.prototype.apply=function(e,t){var n;this.autoTrackStart=!1,this.collect=e,(this.config=t).autotrack&&(n=e.configManager.getSettingData("bav_log_collect"),U(n)&&!n||t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(n=e.Types,this.ready(n.Autotrack),this.collect.emit(n.AutotrackReady)))},Zt.prototype.ready=function(e){this.collect.set(e);e="object"==typeof(e=this.config.autotrack)?e:{};e=Object.assign(Qt,e),this.destroyed=!1,this.options=e,this.Config=new Dt(Tt,this.options),this.Exposure=new Wt(this.collect,this.config,this.handle.bind(this)),this.Scroll=new $t(this.config,this.handle.bind(this)),this.Listener=new kt(e,this.collect,this.Config),this.EventHandle=new xt(this.config,e),this.Request=new Ct(this.collect),this.autoTrackStart=!0,this.init(),qt(this,this.config)},Zt.prototype.init=function(){this.Listener.init(this.handle.bind(this))},Zt.prototype.handle=function(e,t){try{if(this.config.autotrack.collect_url&&!this.config.autotrack.collect_url())return}catch(e){}this.collect.sdkStop||"dom"===e.eventType&&this.handleDom(e,t)},Zt.prototype.handleDom=function(e,t){try{var n,o,i,r,a=e.eventName;"click"===a||"change"===a||"submit"===a?(r=this.EventHandle.handleEvent(t,a))&&this.Request.send({eventType:"custom"},r):"page_view"===a||"page_statistics"===a?(n=void 0,(n="page_view"===a?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t))&&this.Request.send({eventType:"custom"},n)):"beat"===a?(o=this.EventHandle.handleBeadtEvent(t),i=e.eventSend,o&&this.Request.send({eventType:"custom",eventSend:i},o)):"exposure"===a?(r=this.EventHandle.handleExposureEvent(e,t))&&this.Request.send({eventType:"custom"},r):"scroll"===a&&(r=this.EventHandle.handleScrollEvent(e,t))&&this.Request.send({eventType:"custom"},r)}catch(e){console.log("handel dom event error ".concat(JSON.stringify(e)))}},Zt.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},Zt);function Zt(){}function en(e,t){this.distance=30,e.autotrack&&e.autotrack.scroll&&(e.autotrack.scroll.distance&&(this.distance=e.autotrack.scroll.distance),this.eventHandle=t,this.addLinstenr(),this.mutation())}try{var tn=Te();tn&&(tn.LogAutoTrack=function(e,t){(new Yt).apply(e,t)})}catch(u){}var nn={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},on=(M.prototype.apply=function(e,t){var n=this;this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready&&(this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event"),t=this.collect.Types,e=e.adapters.fetch,this.fetch=e,this.collect.on(t.Event,function(){n.addCount("log")}),this.collect.on(t.SubmitError,function(e){var t=e.type;n.addErrorCount(e.eventDate,t,e.errorCode,e.response)}),this.listener(),this.collect.emit(t.TracerReady))},M.prototype.addCount=function(e,t,n){void 0===t&&(t="net"),void 0===n&&(n=1);try{this.tracerCache||(this.tracerCache=new Map);var o,i=void 0;this.tracerCache.has(e)?(o=this.tracerCache.get(e)).has(t)?(i=o.get(t).params.count,i++,o.set(t,this.processTracer(i,e,t))):(i=n,o.set(t,this.processTracer(n,e,t))):(o=new Map,i=n,o.set(t,this.processTracer(n,e,t)),this.tracerCache.set(e,o)),"net"===t&&i>=this.limit[e]&&this.report(!1)}catch(e){console.log(e)}},M.prototype.addErrorCount=function(e,o,i,t){var n,r=this;try{e&&e.length&&(n=e[0].events)&&n.length&&("f_data"===o?(t&&t.hasOwnProperty("sc")?this.addCount("log",o,n.length-t.sc):this.addCount("log",o,n.length),this.errorCode[o]=i):n.forEach(function(e){var t,n="log";for(t in nn)if(-1!==nn[t].indexOf(e.event)){n=t;break}r.addCount(n,o,1),r.errorCode[o]=i}))}catch(e){}},M.prototype.report=function(e){var t;this.tracerCache&&(t=[],this.tracerCache.forEach(function(e){console.log(e),e.forEach(function(e){t.push(e)})}),t)&&t.length&&this.sendTracer(t,e)},M.prototype.sendTracer=function(e,t){try{var n=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(n)):this.fetch(this.reportUrl,n),this.tracerCache=null}catch(e){}},M.prototype.processTracer=function(e,t,n){e={count:e,state:n,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:m},"f_net"!==n&&"f_data"!==n||(e.errorCode=this.errorCode[n]),t=this.collect.processEvent("applog_trace",e);if(t&&t.event)return delete t.is_bav,t},M.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.leavePage()}),V(function(){e.leavePage()})},M.prototype.leavePage=function(){this.report(!0)},M);function M(){}try{var rn=Te();rn&&(rn.LogTracer=function(e,t){(new on).apply(e,t)})}catch(u){console.log(u)}G.prototype.apply=function(e,t){var n=this;F()||(this.collector=e,this.config=t,this.eventStorage=[],this.collector.on("submit-verify-h5",function(e){e&&e.length&&n.eventStore(e[0])}),this.checkUrl(),this.heartbeat())},G.prototype.checkUrl=function(){var e=window.location.href,e=H(e);e._r_d_&&e._r_c_k_?(this.verifyReady=!0,this.domain=e._r_d_,this.key=e._r_c_k_,this.checkCache()):this.collector.off("submit-verify-h5")},G.prototype.checkCache=function(){this.eventStorage.length&&this.postVerify(this.eventStorage)},G.prototype.heartbeat=function(){var o=this;this.heart=setInterval(function(){var e={event:"simulator_test__",local_time_ms:Date.now()},t=o.collector.configManager.get(),n=t.header;o.eventStore({events:[e],user:t.user,header:n})},6e4)},G.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e):this.eventStorage.push(e))},G.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[],clearInterval(this.heart)},G.prototype.postVerify=function(e){var t=this;try{var n=JSON.parse(JSON.stringify(e));$(e)?n.forEach(function(e){t.fetchLog(e)}):this.fetchLog(n)}catch(e){console.log("web verify post error ~")}},G.prototype.fetchLog=function(e){this.collector.requestManager.useRequest({url:"".concat(this.domain,"/simulator/h5/log?connection_key=").concat(this.key),data:e,timeout:2e4})},G.prototype.leave=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.cleanVerify()}),V(function(){e.cleanVerify()})};var x=G,an=ne(function(e,t){e.exports=function n(o,i,r){function a(t,e){if(!i[t]){if(!o[t]){if(!e&&te)return te();if(s)return s(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e=i[t]={exports:{}};o[t][0].call(e.exports,function(e){return a(o[t][1][e]||e)},e,e.exports,n,o,i,r)}return i[t].exports}for(var s=te,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,l,t){!function(t){var o,e,n,i,r=t.MutationObserver||t.WebKitMutationObserver,a=r?(e=0,r=new r(c),n=t.document.createTextNode(""),r.observe(n,{characterData:!0}),function(){n.data=e=++e%2}):t.setImmediate||void 0===t.MessageChannel?"document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)}:((i=new t.MessageChannel).port1.onmessage=c,function(){i.port2.postMessage(0)}),s=[];function c(){var e,t;o=!0;for(var n=s.length;n;){for(t=s,s=[],e=-1;++e<n;)t[e]();n=s.length}o=!1}l.exports=function(e){1!==s.push(e)||o||a()}}.call(this,ee)},{}],2:[function(e,t,n){var i=e(1);function c(){}var l={},r=["REJECTED"],a=["FULFILLED"],o=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=o,this.queue=[],this.outcome=void 0,e!==c&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,n,o){i(function(){var e;try{e=n(o)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,e)})}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(t,e){var n=!1;function o(e){n||(n=!0,l.reject(t,e))}function i(e){n||(n=!0,l.resolve(t,e))}var r=d(function(){e(i,o)});"error"===r.status&&o(r.value)}function d(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=s).prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var n;return"function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===r?this:(n=new this.constructor(c),this.state!==o?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n)},u.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){l.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},l.resolve=function(e,t){var n=d(p,t);if("error"===n.status)return l.reject(e,n.value);n=n.value;if(n)f(e,n);else{e.state=a,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},l.reject=function(e,t){e.state=r,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:l.resolve(new this(c),e)},s.reject=function(e){var t=new this(c);return l.reject(t,e)},s.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var o=e.length,i=!1;if(!o)return this.resolve([]);for(var r=new Array(o),a=0,t=-1,s=new this(c);++t<o;)((e,t)=>{n.resolve(e).then(function(e){r[t]=e,++a!==o||i||(i=!0,l.resolve(s,r))},function(e){i||(i=!0,l.reject(s,e))})})(e[t],t);return s},s.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var o,i=-1,r=new this(c);++i<t;)o=e[i],this.resolve(o).then(function(e){n||(n=!0,l.resolve(r,e))},function(e){n||(n=!0,l.reject(r,e))});return r}},{1:1}],3:[function(t,e,n){!function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}.call(this,ee)},{2:2}],4:[function(e,N,U){var L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=(()=>{try{return"undefined"!=typeof indexedDB?indexedDB:"undefined"!=typeof webkitIndexedDB?webkitIndexedDB:"undefined"!=typeof mozIndexedDB?mozIndexedDB:"undefined"!=typeof OIndexedDB?OIndexedDB:"undefined"!=typeof msIndexedDB?msIndexedDB:void 0}catch(e){}})();function l(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var o=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)o.append(t[i]);return o.getBlob(n.type)}}"undefined"==typeof Promise&&e(3);var f=Promise;function d(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function i(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function r(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u="local-forage-detect-blob-support",p=void 0,g={},P=Object.prototype.toString,n="readonly",m="readwrite";function c(e){var e=g[e.name],n={};n.promise=new f(function(e,t){n.resolve=e,n.reject=t}),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then(function(){return n.promise}):e.dbReady=n.promise}function y(e){e=g[e.name].deferredOperations.pop();e&&(e.resolve(),e.promise)}function v(e,t){e=g[e.name].deferredOperations.pop();if(e)return e.reject(t),e.promise}function t(i,r){return new f(function(t,n){if(g[i.name]=g[i.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},i.db){if(!r)return t(i.db);c(i),i.db.close()}var e=[i.name],o=(r&&e.push(i.version),s.open.apply(s,e));r&&(o.onupgradeneeded=function(e){var t=o.result;try{t.createObjectStore(i.storeName),e.oldVersion<=1&&t.createObjectStore(u)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+i.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+i.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){var e=o.result;e.onversionchange=function(e){e.target.close()},t(e),y(i)}})}function _(e){return t(e,!1)}function b(e){return t(e,!0)}function E(e,t){var n,o,i;return!e.db||(n=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,o=e.version>e.db.version,i&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(o||n)&&(n&&(i=e.db.version+1,e.version<i)&&(e.version=i),1))}function z(e){return l([(e=>{for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),i=0;i<t;i++)o[i]=e.charCodeAt(i);return n})(atob(e.data))],{type:e.type})}function j(e){return e&&e.__local_forage_encoded_blob}function V(e){var t=this,n=t._initReady().then(function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return i(n,e,e),n}function S(e,t,n,o){void 0===o&&(o=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(0<o&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return f.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),b(e)}).then(function(){return(n=>{c(n);for(var o=g[n.name],i=o.forages,e=0;e<i.length;e++){var t=i[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return n.db=null,_(n).then(function(e){return n.db=e,E(n)?b(n):e}).then(function(e){n.db=o.db=e;for(var t=0;t<i.length;t++)i[t]._dbInfo.db=e}).catch(function(e){throw v(n,e),e})})(e).then(function(){S(e,t,n,o-1)})}).catch(n);n(i)}}var e={_driver:"asyncStorage",_initStorage:function(e){var o=this,i={db:null};if(e)for(var t in e)i[t]=e[t];var r=g[i.name],n=(r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},g[i.name]=r),r.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=V),[]);function a(){return f.resolve()}for(var s=0;s<r.forages.length;s++){var c=r.forages[s];c!==o&&n.push(c._initReady().catch(a))}var l=r.forages.slice(0);return f.all(n).then(function(){return i.db=r.db,_(i)}).then(function(e){return i.db=e,E(i,o._defaultConfig.version)?b(i):e}).then(function(e){i.db=r.db=e,o._dbInfo=i;for(var t=0;t<l.length;t++){var n=l[t];n!==o&&(n._dbInfo.db=i.db,n._dbInfo.version=i.version)}})},_support:(()=>{try{var e,t;return s&&s.open?(e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code"),(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange):!1}catch(e){return!1}})(),iterate:function(a,e){var s=this,t=new f(function(i,r){s.ready().then(function(){S(s._dbInfo,n,function(e,t){if(e)return r(e);try{var n=t.objectStore(s._dbInfo.storeName).openCursor(),o=1;n.onsuccess=function(){var e,t=n.result;t?(j(e=t.value)&&(e=z(e)),void 0!==(e=a(e,t.key,o++))?i(e):t.continue()):i()},n.onerror=function(){r(n.error)}}catch(e){r(e)}})}).catch(r)});return d(t,e),t},getItem:function(r,e){var a=this,t=(r=h(r),new f(function(o,i){a.ready().then(function(){S(a._dbInfo,n,function(e,t){if(e)return i(e);try{var n=t.objectStore(a._dbInfo.storeName).get(r);n.onsuccess=function(){var e=n.result;j(e=void 0===e?null:e)&&(e=z(e)),o(e)},n.onerror=function(){i(n.error)}}catch(e){i(e)}})}).catch(i)}));return d(t,e),t},setItem:function(s,n,e){var c=this,t=(s=h(s),new f(function(r,a){var t;c.ready().then(function(){return t=c._dbInfo,"[object Blob]"===P.call(n)?(e=t.db,("boolean"==typeof p?f.resolve(p):(o=e,new f(function(n){var e=o.transaction(u,m),t=l([""]);e.objectStore(u).put(t,"key"),e.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)},e.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1}).then(function(e){return p=e}))).then(function(e){return e?n:(o=n,new f(function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){e=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:e,type:o.type})},n.readAsBinaryString(o)}));var o})):n;var e,o}).then(function(i){S(c._dbInfo,m,function(e,t){if(e)return a(e);try{var n=t.objectStore(c._dbInfo.storeName),o=(null===i&&(i=void 0),n.put(i,s));t.oncomplete=function(){r(i=void 0===i?null:i)},t.onabort=t.onerror=function(){try{var e=o.error||o.transaction.error;a(e)}catch(e){a(e)}}}catch(e){a(e)}})}).catch(a)}));return d(t,e),t},removeItem:function(r,e){var a=this,t=(r=h(r),new f(function(o,i){a.ready().then(function(){S(a._dbInfo,m,function(e,t){if(e)return i(e);try{var n=t.objectStore(a._dbInfo.storeName).delete(r);t.oncomplete=function(){o()},t.onerror=function(){i(n.error)},t.onabort=function(){try{var e=n.error||n.transaction.error;i(e)}catch(e){i(e)}}}catch(e){i(e)}})}).catch(i)}));return d(t,e),t},clear:function(e){var r=this,t=new f(function(o,i){r.ready().then(function(){S(r._dbInfo,m,function(e,t){if(e)return i(e);try{var n=t.objectStore(r._dbInfo.storeName).clear();t.oncomplete=function(){o()},t.onabort=t.onerror=function(){try{var e=n.error||n.transaction.error;i(e)}catch(e){i(e)}}}catch(e){i(e)}})}).catch(i)});return d(t,e),t},length:function(e){var r=this,t=new f(function(o,i){r.ready().then(function(){S(r._dbInfo,n,function(e,t){if(e)return i(e);try{var n=t.objectStore(r._dbInfo.storeName).count();n.onsuccess=function(){o(n.result)},n.onerror=function(){i(n.error)}}catch(e){i(e)}})}).catch(i)});return d(t,e),t},key:function(s,e){var c=this,t=new f(function(r,a){s<0?r(null):c.ready().then(function(){S(c._dbInfo,n,function(e,t){if(e)return a(e);try{var n=t.objectStore(c._dbInfo.storeName),o=!1,i=(n.openKeyCursor||n.openCursor).call(n);i.onsuccess=function(){var e=i.result;e?0===s||o?r(e.key):(o=!0,e.advance(s)):r(null)},i.onerror=function(){a(i.error)}}catch(e){a(e)}})}).catch(a)});return d(t,e),t},keys:function(e){var s=this,t=new f(function(r,a){s.ready().then(function(){S(s._dbInfo,n,function(e,t){if(e)return a(e);try{var n=t.objectStore(s._dbInfo.storeName),o=(n.openKeyCursor||n.openCursor).call(n),i=[];o.onsuccess=function(){var e=o.result;e?(i.push(e.key),e.continue()):r(i)},o.onerror=function(){a(o.error)}}catch(e){a(e)}})}).catch(a)});return d(t,e),t},dropInstance:function(a,e){e=r.apply(this,arguments);var t=this.config();return(a="function"!=typeof a&&a||{}).name||(a.name=a.name||t.name,a.storeName=a.storeName||t.storeName),d(t=a.name?(t=a.name===t.name&&this._dbInfo.db?f.resolve(this._dbInfo.db):_(a).then(function(e){var t=g[a.name],n=t.forages;t.db=e;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=e;return e}),a.storeName?t.then(function(e){if(e.objectStoreNames.contains(a.storeName)){var i=e.version+1,o=(c(a),g[a.name]),r=o.forages;e.close();for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=null,n._dbInfo.version=i}return new f(function(t,n){var o=s.open(a.name,i);o.onerror=function(e){o.result.close(),n(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(a.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}).then(function(e){o.db=e;for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=e,y(n._dbInfo)}}).catch(function(e){throw(v(a,e)||f.resolve()).catch(function(){}),e})}}):t.then(function(e){c(a);var n=g[a.name],o=n.forages;e.close();for(var t=0;t<o.length;t++)o[t]._dbInfo.db=null;return new f(function(t,n){var o=s.deleteDatabase(a.name);o.onerror=function(){var e=o.result;e&&e.close(),n(o.error)},o.onblocked=function(){console.warn('dropInstance blocked for database "'+a.name+'" until all open connections are closed')},o.onsuccess=function(){var e=o.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<o.length;t++)y(o[t]._dbInfo)}).catch(function(e){throw(v(a,e)||f.resolve()).catch(function(){}),e})})):f.reject("Invalid arguments"),e),t}},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=/^~~local_forage_type~([^~]+)~/,a="__lfsc__:",k=a.length,T="arbf",D="blob",q=k+T.length,H=Object.prototype.toString;function J(e){for(var t,n,o,i,r=.75*e.length,a=e.length,s=0,r=("="===e[e.length-1]&&(r--,"="===e[e.length-2])&&r--,new ArrayBuffer(r)),c=new Uint8Array(r),l=0;l<a;l+=4)t=w.indexOf(e[l]),n=w.indexOf(e[l+1]),o=w.indexOf(e[l+2]),i=w.indexOf(e[l+3]),c[s++]=t<<2|n>>4,c[s++]=(15&n)<<4|o>>2,c[s++]=(3&o)<<6|63&i;return r}function A(e){for(var t=new Uint8Array(e),n="",o=0;o<t.length;o+=3)n=(n=(n=(n+=w[t[o]>>2])+w[(3&t[o])<<4|t[o+1]>>4])+w[(15&t[o+1])<<2|t[o+2]>>6])+w[63&t[o+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var O={serialize:function(t,n){var e="";if(t&&(e=H.call(t)),t&&("[object ArrayBuffer]"===e||t.buffer&&"[object ArrayBuffer]"===H.call(t.buffer))){var o,i=a;t instanceof ArrayBuffer?(o=t,i+=T):(o=t.buffer,"[object Int8Array]"===e?i+="si08":"[object Uint8Array]"===e?i+="ui08":"[object Uint8ClampedArray]"===e?i+="uic8":"[object Int16Array]"===e?i+="si16":"[object Uint16Array]"===e?i+="ur16":"[object Int32Array]"===e?i+="si32":"[object Uint32Array]"===e?i+="ui32":"[object Float32Array]"===e?i+="fl32":"[object Float64Array]"===e?i+="fl64":n(new Error("Failed to get type for BinaryArray"))),n(i+A(o))}else if("[object Blob]"===e){i=new FileReader;i.onload=function(){var e="~~local_forage_type~"+t.type+"~"+A(this.result);n(a+D+e)},i.readAsArrayBuffer(t)}else try{n(JSON.stringify(t))}catch(e){console.error("Couldn't convert value into a JSON string: ",t),n(null,e)}},deserialize:function(e){if(e.substring(0,k)!==a)return JSON.parse(e);var t,n=e.substring(q),o=e.substring(k,q),i=(o===D&&K.test(n)&&(t=(e=n.match(K))[1],n=n.substring(e[0].length)),J(n));switch(o){case T:return i;case D:return l([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+o)}},stringToBuffer:J,bufferToString:A};function F(e,t,n,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,o)}function I(e,o,i,r,a,s){e.executeSql(i,r,a,function(e,n){n.code===n.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[o.storeName],function(e,t){t.rows.length?s(e,n):F(e,o,function(){e.executeSql(i,r,a,s)},s)},s):s(e,n)},s)}var o={_driver:"webSQLStorage",_initStorage:function(e){var o=this,i={db:null};if(e)for(var t in e)i[t]="string"!=typeof e[t]?e[t].toString():e[t];var n=new f(function(t,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return n(t)}i.db.transaction(function(e){F(e,i,function(){o._dbInfo=i,t()},function(e,t){n(t)})},n)});return i.serializer=O,n},_support:"function"==typeof openDatabase,iterate:function(l,e){var t=this,n=new f(function(c,n){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(e){I(e,s,"SELECT * FROM "+s.storeName,[],function(e,t){for(var n=t.rows,o=n.length,i=0;i<o;i++){var r=n.item(i),a=(a=r.value)&&s.serializer.deserialize(a);if(void 0!==(a=l(a,r.key,i+1)))return void c(a)}c()},function(e,t){n(t)})})}).catch(n)});return d(n,e),n},getItem:function(t,e){var r=this,n=(t=h(t),new f(function(o,i){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(e){I(e,n,"SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[t],function(e,t){t=(t=t.rows.length?t.rows.item(0).value:null)&&n.serializer.deserialize(t);o(t)},function(e,t){i(t)})})}).catch(i)}));return d(n,e),n},setItem:function(e,t,n){return function a(s,e,c,l){var u=this,t=(s=h(s),new f(function(i,r){u.ready().then(function(){var n=e=void 0===e?null:e,o=u._dbInfo;o.serializer.serialize(e,function(t,e){e?r(e):o.db.transaction(function(e){I(e,o,"INSERT OR REPLACE INTO "+o.storeName+" (key, value) VALUES (?, ?)",[s,t],function(){i(n)},function(e,t){r(t)})},function(e){e.code===e.QUOTA_ERR&&(0<l?i(a.apply(u,[s,n,c,l-1])):r(e))})})}).catch(r)}));return d(t,c),t}.apply(this,[e,t,n,1])},removeItem:function(i,e){var r=this,t=(i=h(i),new f(function(n,o){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){I(e,t,"DELETE FROM "+t.storeName+" WHERE key = ?",[i],function(){n()},function(e,t){o(t)})})}).catch(o)}));return d(t,e),t},clear:function(e){var i=this,t=new f(function(n,o){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){I(e,t,"DELETE FROM "+t.storeName,[],function(){n()},function(e,t){o(t)})})}).catch(o)});return d(t,e),t},length:function(e){var i=this,t=new f(function(n,o){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){I(e,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(e,t){t=t.rows.item(0).c;n(t)},function(e,t){o(t)})})}).catch(o)});return d(t,e),t},key:function(i,e){var r=this,t=new f(function(n,o){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){I(e,t,"SELECT key FROM "+t.storeName+" WHERE id = ? LIMIT 1",[i+1],function(e,t){t=t.rows.length?t.rows.item(0).key:null;n(t)},function(e,t){o(t)})})}).catch(o)});return d(t,e),t},keys:function(e){var o=this,t=new f(function(i,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){I(e,t,"SELECT key FROM "+t.storeName,[],function(e,t){for(var n=[],o=0;o<t.rows.length;o++)n.push(t.rows.item(o).key);i(n)},function(e,t){n(t)})})}).catch(n)});return d(t,e),t},dropInstance:function(n,e){e=r.apply(this,arguments);var o=this.config();(n="function"!=typeof n&&n||{}).name||(n.name=n.name||o.name,n.storeName=n.storeName||o.storeName);var t,i=this;return d(t=n.name?new f(function(e){var r,t=n.name===o.name?i._dbInfo.db:openDatabase(n.name,"","",0);n.storeName?e({db:t,storeNames:[n.storeName]}):e((r=t,new f(function(i,n){r.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,t){for(var n=[],o=0;o<t.rows.length;o++)n.push(t.rows.item(o).name);i({db:r,storeNames:n})},function(e,t){n(t)})},function(e){n(e)})})))}).then(function(a){return new f(function(i,r){a.db.transaction(function(o){for(var e=[],t=0,n=a.storeNames.length;t<n;t++)e.push((t=>new f(function(e,n){o.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(e,t){n(t)})}))(a.storeNames[t]));f.all(e).then(function(){i()}).catch(function(e){r(e)})},function(e){r(e)})})}):f.reject("Invalid arguments"),e),t}};function W(e,t){var n="";return e.name&&(n=e.name+"/"),e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}var X={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=W(e,this._defaultConfig),!(()=>{try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),0}catch(e){return 1}})()||0<localStorage.length?((this._dbInfo=t).serializer=O,f.resolve()):f.reject()},_support:(()=>{try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}})(),iterate:function(c,e){var l=this,t=l.ready().then(function(){for(var e=l._dbInfo,t=e.keyPrefix,n=t.length,o=localStorage.length,i=1,r=0;r<o;r++){var a=localStorage.key(r);if(0===a.indexOf(t)){var s=(s=localStorage.getItem(a))&&e.serializer.deserialize(s);if(void 0!==(s=c(s,a.substring(n),i++)))return s}}});return d(t,e),t},getItem:function(n,e){var o=this,t=(n=h(n),o.ready().then(function(){var e=o._dbInfo,t=localStorage.getItem(e.keyPrefix+n);return t=t&&e.serializer.deserialize(t)}));return d(t,e),t},setItem:function(a,e,t){var s=this,n=(a=h(a),s.ready().then(function(){var r=e=void 0===e?null:e;return new f(function(n,o){var i=s._dbInfo;i.serializer.serialize(e,function(e,t){if(t)o(t);else try{localStorage.setItem(i.keyPrefix+a,e),n(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}})})}));return d(n,t),n},removeItem:function(t,e){var n=this,o=(t=h(t),n.ready().then(function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return d(o,e),o},clear:function(e){var o=this,t=o.ready().then(function(){for(var e=o._dbInfo.keyPrefix,t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}});return d(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return d(t,e),t},key:function(n,e){var o=this,t=o.ready().then(function(){var t,e=o._dbInfo;try{t=localStorage.key(n)}catch(e){t=null}return t=t&&t.substring(e.keyPrefix.length)});return d(t,e),t},keys:function(e){var r=this,t=r.ready().then(function(){for(var e=r._dbInfo,t=localStorage.length,n=[],o=0;o<t;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&n.push(i.substring(e.keyPrefix.length))}return n});return d(t,e),t},dropInstance:function(t,e){e=r.apply(this,arguments),(t="function"!=typeof t&&t||{}).name||(n=this.config(),t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var n,o=this;return d(n=t.name?new f(function(e){t.storeName?e(W(t,o._defaultConfig)):e(t.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):f.reject("Invalid arguments"),e),n}},$=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},R={},Q={},M={INDEXEDDB:e,WEBSQL:o,LOCALSTORAGE:X},e=[M.INDEXEDDB._driver,M.WEBSQL._driver,M.LOCALSTORAGE._driver],x=["dropInstance"],C=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(x),Y={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function G(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var o in n)n.hasOwnProperty(o)&&($(n[o])?e[o]=n[o].slice():e[o]=n[o])}return e}B.prototype.config=function(e){if("object"!==(void 0===e?"undefined":L(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},B.prototype.defineDriver=function(p,e,t){var n=new f(function(t,n){try{var o=p._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(p._driver){for(var i=C.concat("_initStorage"),r=0,a=i.length;r<a;r++){var s=i[r];if((!((e,t)=>{for(var n,o,i=e.length,r=0;r<i;){if((n=e[r])===(o=t)||"number"==typeof n&&"number"==typeof o&&isNaN(n)&&isNaN(o))return!0;r++}return!1})(x,s)||p[s])&&"function"!=typeof p[s])return void n(e)}for(var c=0,l=x.length;c<l;c++){var u=x[c];p[u]||(p[u]=(t=>function(){var e=new Error("Method "+t+" is not implemented by the current driver"),e=f.reject(e);return d(e,arguments[arguments.length-1]),e})(u))}var h=function(e){R[o]&&console.info("Redefining LocalForage driver: "+o),R[o]=p,Q[o]=e,t()};"_support"in p?p._support&&"function"==typeof p._support?p._support().then(h,n):h(!!p._support):h(!0)}else n(e)}catch(e){n(e)}});return i(n,e,t),n},B.prototype.driver=function(){return this._driver||null},B.prototype.getDriver=function(e,t,n){e=R[e]?f.resolve(R[e]):f.reject(new Error("Driver not found."));return i(e,t,n),e},B.prototype.getSerializer=function(e){var t=f.resolve(O);return i(t,e),t},B.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return i(n,e,e),n},B.prototype.setDriver=function(e,t,n){var r=this,o=($(e)||(e=[e]),this._getSupportedDrivers(e));function a(){r._config.driver=r.driver()}function s(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}e=null!==this._driverSet?this._driverSet.catch(function(){return f.resolve()}):f.resolve();return this._driverSet=e.then(function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then(function(e){var i;r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=(i=o,function(){var o=0;return function e(){for(;o<i.length;){var t=i[o];return o++,r._dbInfo=null,r._ready=null,r.getDriver(t).then(s).catch(e)}a();var n=new Error("No available storage method found.");return r._driverSet=f.reject(n),r._driverSet}()})})}).catch(function(){a();var e=new Error("No available storage method found.");return r._driverSet=f.reject(e),r._driverSet}),i(this._driverSet,t,n),this._driverSet},B.prototype.supports=function(e){return!!Q[e]},B.prototype._extend=function(e){G(this,e)},B.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},B.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=C.length;e<t;e++)((t,n)=>{t[n]=function(){var e=arguments;return t.ready().then(function(){return t[n].apply(t,e)})}})(this,C[e])},B.prototype.createInstance=function(e){return new B(e)};o=new B;function B(e){var t,n,o;if(!(this instanceof B))throw new TypeError("Cannot call a class as a function");for(t in M)M.hasOwnProperty(t)&&(o=(n=M[t])._driver,this[t]=o,R[o]||this.defineDriver(n));this._defaultConfig=G({},Y),this._config=G({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}N.exports=o},{3:3}]},{},[4])(4)}),sn=(ln.prototype.getItem=function(o){return r(this,void 0,void 0,function(){var t,n;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.dbStorage.getItem(o)];case 1:t=e.sent(),n=t;try{t&&"string"==typeof t&&(n=JSON.parse(t))}catch(e){}return[2,n||void 0];case 2:return e.sent(),console.warn("db get storage error"),[3,3];case 3:return[2,void 0]}})})},ln.prototype.setItem=function(e,t){try{this.dbStorage.setItem(e,t)}catch(e){console.warn("db set storage error")}},ln.prototype.removeItem=function(e){try{this.dbStorage.removeItem(e)}catch(e){console.warn("db remove storage error")}},ln),cn=(C.prototype.apply=function(e,t){var n=this;try{e.destroy||t.enable_storage&&(this.collect=e,this.config=t,this.storage=new sn(t.app_id,"DEGRADE_EVENT_STORE"),this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__applog_degrade_events",this.eventSleepTimeKey="__applog_degrade_events_sleep_time",this.collect.on("http-error",function(e){n.setErrorData(e)}),this.collect.on("backoff-ratio",function(e){e&&0===e.e&&(n.backoff_ratio=e.backoff_ratio||0)}),this.checkStorage())}catch(e){console.log("degrade init error",JSON.stringify(e))}},C.prototype.getSleepTime=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return[4,(t=this).storage.getItem(this.eventSleepTimeKey)];case 1:return t.sleepTime=e.sent()||this.sleepTime,console.log(this.sleepTime),[2]}})})},C.prototype.triggerDegrade=function(n){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),console.log("degradeInfo",n),t=n.data,"degrade"===n.status?(this.addSleep(),[2]):(this.degradeStarted=!0,this.collect.degradeStarted=!0,[4,this.setEventStorage(t)]);case 1:return e.sent(),this.tryReportStoreData(),this.firstTrigger||this.addSleep(),this.firstTrigger=!1,[3,3];case 2:return t=e.sent(),console.log("trigger degrade error",JSON.stringify(t)),[3,3];case 3:return[2]}})})},C.prototype.checkStorage=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return(t=e.sent())&&t.size?(this.degradeStarted=!0,this.collect.degradeStarted=!0,this.tryReportStoreData(),[3,3]):[2];case 2:return e.sent(),console.log("check storage error"),[3,3];case 3:return[2]}})})},C.prototype.setErrorData=function(t){return r(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return"degrade"===t.status?[2]:[4,this.setEventStorage(t)];case 1:return e.sent(),[2]}})})},C.prototype.setEventStorage=function(i){return r(this,void 0,void 0,function(){var t,n,o;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return t=(t=e.sent())||new Map,n=ke(),o=i.data,console.log("eventS",JSON.stringify(o)),t.set(n,{eventData:o,id:n}),this.setDataToDB(t),[3,3];case 2:return e.sent(),console.warn("set DB storage error"),[3,3];case 3:return[2]}})})},C.prototype.getStoragefromDBToSlice=function(){return r(this,void 0,void 0,function(){var t,n,o,i,r,a,s,c,l,u,h=this;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:if(t=e.sent(),console.log("eventMap",t),n=new Map,o=[],this.tempId=[],t.size<=this.maxSilceCount)n=t;else try{for(i=(e=>{var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&o>=e.length?void 0:e)&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")})(t),r=i.next();!r.done&&(a=f(r.value,2),s=a[0],c=a[1],n.size<this.maxSilceCount);r=i.next())n.set(s,c)}catch(e){l={error:e}}finally{try{r&&!r.done&&(u=i.return)&&u.call(i)}finally{if(l)throw l.error}}return n.forEach(function(e){o.push(e.eventData[0]),h.tempId.push(e.id)}),[2,o];case 2:return e.sent(),[2,[]];case 3:return[2]}})})},C.prototype.setDataToDB=function(t){try{console.log("set data ",t),this.storage.setItem(this.eventKey,t)}catch(e){console.log("set data to DB error",JSON.stringify(e)),this.dropEvents(t)}},C.prototype.dropEvents=function(e){try{var t=this.collect.configManager.get(),n=t.user,o=t.header,i=(o.app_id=1338,[]),r=(e.forEach(function(e){var t=e.event;i.push({eventName:t,eventTime:e.local_time_ms})}),{events:[{event:"sdk_monitor",params:JSON.stringify({storage_fails:i}),local_time_ms:Date.now()}],user:n,header:o});this.collect.requestManager.useRequest({url:this.eventUrl,data:r,timeout:3e4,type:"event"})}catch(e){console.log("drop data error",JSON.stringify(e))}},C.prototype.tryReportStoreData=function(){var e=this;if(!this.sendStatus){this.sendStatus=!0;try{this.sleepFn=setTimeout(function(){return r(e,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return[4,this.getStoragefromDBToSlice()];case 1:return!(t=e.sent()).length||0!==this.backoff_ratio&&this.backoff_ratio&&this.random()<this.backoff_ratio?clearTimeout(this.sleepFn):this.fetchData(t),[2]}})})},this.sleepTime)}catch(e){console.warn("error check storage")}}},C.prototype.addSleep=function(){this.sendStatus=!1,this.sleepTime=2*this.sleepTime,this.sleepTime>this.maxTime&&(this.sleepTime=this.maxTime),this.storage.setItem(this.eventSleepTimeKey,this.sleepTime),clearTimeout(this.sleepFn),this.tryReportStoreData()},C.prototype.reduceDataFromDB=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this.degradeStarted?(this.sendStatus=!1,this.goodCount+=1,clearTimeout(this.sleepFn),[4,this.storage.getItem(this.eventKey)]):[2];case 1:return t=e.sent(),this.tempId.length&&t&&(this.tempId.forEach(function(e){t.delete(e)}),this.tempId=[],this.setDataToDB(t)),this.storage.setItem(this.eventSleepTimeKey,this.sleepTime),[4,this.reportRest()];case 2:return e.sent(),[3,4];case 3:return e.sent(),console.warn("reduceDataFromDB error"),[3,4];case 4:return[2]}})})},C.prototype.reportRest=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.getItem(this.eventKey)];case 1:return(t=e.sent())&&t.size?(this.tryReportStoreData(),[3,3]):[2];case 2:return e.sent(),[3,3];case 3:return[2]}})})},C.prototype.random=function(){return Math.floor(1e4*Math.random())},C.prototype.fetchData=function(e){var t=this;this.collect.requestManager.useRequest({url:this.eventUrl,data:e,timeout:3e4,type:"event",status:"degrade",success:function(){t.reduceDataFromDB()}})},C.prototype.destroy=function(){this.collect.off("http-error"),this.collect.off("http-ok")},C);function C(){this.errorCache=new Map,this.sleepTime=1e3,this.maxTime=16e3,this.minTime=1e3,this.goodCount=0,this.maxGoodCount=2,this.maxSilceCount=50,this.sendStatus=!1,this.firstTrigger=!0,this.degradeStarted=!1,this.backoff_ratio=0,this.tempId=[]}function ln(e,t){return this.dbStorage=an.createInstance({driver:[an.INDEXEDDB,an.LOCALSTORAGE],name:"applog_sdk_event_store_".concat(e),storeName:t}),this.dbStorage}function G(){this.verifyReady=!1,this.cleanStatus=!1}try{var un=Te();un&&(un.LogStore=function(e,t){(new cn).apply(e,t)})}catch(u){console.log(u)}B.prototype.apply=function(e,t){var n;(t.spa||t.autotrack)&&(n=e.Types,this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(n.RouteReady))},B.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_".concat(this.appid),this.cache={refer_key:"",refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},B.prototype.hack=function(){var i=this,r=window.history.pushState,a=(history.pushState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"function"==typeof history.onpushstate&&history.onpushstate({state:e});var o=r.call.apply(r,h([history,e],f(t)));return i.collect.emit("STATE_CHANGE",e),i.lastLocation!==location.href&&(i.setReferCache(i.lastLocation),e=i.getPopStateChangeEventData(),i.lastLocation=location.href,i.sendPv(e,"pushState")),o},history.replaceState);history.replaceState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var o=a.call.apply(a,h([history,e],f(t)));return i.collect.emit("STATE_CHANGE",e),i.lastLocation!==location.href&&(i.setReferCache(i.lastLocation),e=i.getPopStateChangeEventData(),i.lastLocation=location.href,i.sendPv(e)),o}},B.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},B.prototype.getLocation=function(){return this.lastLocation},B.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},B.prototype.listener=function(){var n=this,o=null;window.addEventListener("hashchange",function(e){var t;n.lastLocation!==window.location.href&&(clearTimeout(o),n.allowHash)&&(n.setReferCache(n.lastLocation),n.lastLocation=window.location.href,t=n.getPopStateChangeEventData(),n.sendPv(t))}),window.addEventListener("popstate",function(e){n.lastLocation!==window.location.href&&(o=setTimeout(function(){n.setReferCache(n.lastLocation),n.lastLocation=window.location.href;var e=n.getPopStateChangeEventData();n.sendPv(e)},10))})},B.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},B.prototype.pageConfig=function(){try{var e=this.storage.getItem(this.cache_key)||{},t=this.storage.getItem("__tea_cache_first_".concat(this.appid)),n=!t||1!=t;return{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:e&&e.refer_manual_key||"",refer_page_title:e&&e.refer_title||"",page_path:this.collect.handlePath(),url_path:this.collect.handlePath(),page_host:location.host,is_first_time:"".concat(n)}}catch(e){return this.collect.emit(y.DEBUGGER_MESSAGE,{type:y.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),{}}},B.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},B.prototype.handleRefer=function(){var e="";try{var t=this.storage.getItem(this.cache_key)||{},e=t.routeChange?t.refer_key:this.collect.configManager.get("referrer")}catch(t){e=document.referrer}return e},B.prototype.setReferCache=function(e){var t=this.storage.getItem(this.cache_key)||{};t.refer_key=e,t.routeChange=!0,this.storage.setItem(this.cache_key,t)};var hn=B;function B(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}try{var pn=Te();pn&&(pn.LogRoute=function(e,t){(new hn).apply(e,t)})}catch(u){console.log(u)}var fn=["getConfig","getAbSdkVersion"],dn=["init","usePlugin","autoInitializationRangers","on"],tn=(gn.prototype.processTask=function(){var e,t,n,o=this;this.task.length&&-1!==(e=this.findIndex(this.task,dn,"0"))&&(t=this.processScope(this.task[e][0]).scope,this.processMap.set(t,!0),this.processCmd.apply(this,h([],f(this.task[e]))),this.newProcessTask=this.task.filter(function(e){if("default"===t){if(-1===e[0].indexOf("."))return e}else if(-1!==e[0].indexOf("".concat(t,".")))return e}),n=this.findIndex(this.newProcessTask,dn,"0"),this.newProcessTask.forEach(function(e,t){t!==n&&o.processCmd.apply(o,h([],f(e)))}),this.newProcessTask=[])},gn.prototype.processCmd=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if($(e)){var n=this.processScope(e[0]),o=n.scope,n=n.cmd;if(this.processMap.get(o))return e.splice(0,1),-1!==fn.indexOf(n)?this.callCmd(o,n,e):void this.callCmd(o,n,e);this.task.push(e),this.processTask()}},gn.prototype.callCmd=function(e,t,n){try{if(-1===dn.indexOf(t)||this.collectMap.get(e)||(this.collect=new this.Collector(e),this.collectMap.set(e,this.collect)),this.collectMap.get(e)){var o=this.collectMap.get(e);if(o&&o[t])if("event"===t)o.event.apply(o,h([t],f(n)));else{if(-1!==fn.indexOf(t))return o[t].apply(o,h([],f(n)));o[t].apply(o,h([],f(n)))}else o.event.apply(o,h([t],f(n)))}else console.log("init or use must be first call, cmd:".concat(t))}catch(e){console.log(e.message)}},gn.prototype.findIndex=function(e,n,o){var i=this,r=-1;try{e.forEach(function(e,t){e=void 0!==o?e[o]:e,e=i.processScope(e).cmd;-1!==n.indexOf(e)&&(r=t)})}catch(e){}return r},gn.prototype.processScope=function(e){var t,n="default";try{"string"==typeof e&&-1<e.indexOf(".")&&(n=(t=e.split("."))[0],e=t[1])}catch(t){}return{scope:n,cmd:e}},gn);function gn(e){this.task=[],this.newProcessTask=[],this.processMap=!1,this.Collector=e,this.collectMap=new Map,this.processMap=new Map}t.usePlugin(lt,"ab"),t.usePlugin(ft,"stay"),t.usePlugin(Yt,"autotrack"),t.usePlugin(cn,"degrade"),t.usePlugin(x,"verify_h5"),t.usePlugin(A,"heartbeat"),t.usePlugin(ut,"monitor"),t.usePlugin(hn,"route"),t.usePlugin(on,"tracer"),rn=new tn(t),"undefined"!=typeof window&&(un=(()=>{if("undefined"!=typeof window)return window.LogAnalyticsObject||window.TeaAnalyticsObject})())&&window[un]&&((pn=window[un]).sdkLoad?console.log("you page has load sdk file already, do not load another sdk file"):(rn.task=pn.q||[],window[un]=rn.processCmd.bind(rn),window[un].sdkLoad=!0,rn.processTask()))})();